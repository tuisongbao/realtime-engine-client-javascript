!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d,e,f;f=a("debug")("engine:authorizer"),e=a("./utils/requester"),d=function(){function a(a){this.engine=a}return a.prototype.authorize=function(a,b,c){var d,g,h,i;return g=a.authEndpoint||this.engine.options.authEndpoint,g||Utils.throwError("authEndpoint is not configured."),h=a.authTransport||this.engine.options.authTransport,d=a.authData||this.engine.options.authData,"object"==typeof d&&(d=JSON.stringify(d)),b.socketId=this.engine.connection.socketId,d&&(b.authData=d),i="undefined"!=typeof window&&null!==window&&"jsonp"===h?e.jsonp:e.post,f("send auth request",{authEndpoint:g,data:b}),i(g,b,function(a,b){return f("got auth response",{err:a,authResult:b}),a?c({message:"Wrong auth response",error:a}):c(null,b)})},a}(),b.exports=d},{"./utils/requester":33,debug:38}],2:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;f=a("debug")("engine:channel"),e=a("../utils/eventEmitter"),d=function(a){function b(a,b){var c;this.name=a,this.engine=b,c=!1}return g(b,a),b.prototype._authorize=function(a){return a(null)},b.prototype.subscribe=function(){return f("subscribe",this.name),this._authorize(function(a){return function(b,c){return b?a.handleEvent({name:"engine_channel:subscription_error",data:b}):a.engine.connection.sendEvent("engine_channel:subscribe",{channel:a.name,signature:null!=c?c.signature:void 0,channelData:null!=c?c.channelData:void 0})}}(this))},b.prototype.unsubscribe=function(){return f("unsubscribe",this.name),this.engine.connection.sendEvent("engine_channel:unsubscribe",{channel:this.name})},b.prototype.handleEvent=function(a){switch(a.name){case"engine_channel:subscription_succeeded":return this.subscribed=!0,this.trigger("engine:subscription_succeeded",a.data);case"engine_channel:subscription_error":return this.subscribed=!1,this.trigger("engine:subscription_error",a.data);default:return this.trigger(a.name,a.data)}},b.prototype.disconnect=function(){return this.subscribed=!1},b}(e),b.exports=d},{"../utils/eventEmitter":30,debug:38}],3:[function(a,b,c){"use strict";var d,e,f,g,h,i={}.hasOwnProperty;d=a("./channel"),g=a("./privateChannel"),f=a("./presenceChannel"),h=a("../protocol"),e=function(){function a(a){this.engine=a,this._store={}}return a.prototype._createChannel=function(a){return-1!==a.indexOf("private-")?new g(a,this.engine):-1!==a.indexOf("presence-")?new f(a,this.engine):new d(a,this.engine)},a.prototype._isConnected=function(){return"connected"===this.engine.connection.state},a.prototype.subscribe=function(a){var b,c;return h.validateChannel(a),null==(b=this._store)[a]&&(b[a]=this._createChannel(a)),c=this._store[a],this._isConnected()&&c.subscribe(),c},a.prototype.unsubscribe=function(a){var b;return h.validateChannel(a),this._isConnected()&&null!=(b=this._store[a])&&b.unsubscribe(),delete this._store[a]},a.prototype.find=function(a){return h.validateChannel(a),this._store[a]},a.prototype.subscribeAll=function(){var a,b,c,d;if(this._isConnected()){c=this._store,d=[];for(b in c)i.call(c,b)&&(a=c[b],d.push(a.subscribe()));return d}},a.prototype.disconnect=function(){var a,b,c,d;c=this._store,d=[];for(b in c)i.call(c,b)&&(a=c[b],d.push(a.disconnect()));return d},a}(),b.exports=e},{"../protocol":29,"./channel":2,"./presenceChannel":4,"./privateChannel":5}],4:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./privateChannel"),f=a("./users"),d=function(a){function b(a,c){this.name=a,this.engine=c,b.__super__.constructor.call(this,this.name,this.engine),this.users=new f}return g(b,a),b.prototype._authorize=function(a){return b.__super__._authorize.call(this,function(b){return function(c,d){try{c||b.users.setMyId(JSON.parse(d.channelData).userId)}catch(e){}return a(c,d)}}(this))},b.prototype.handleEvent=function(a){var c,d;switch(a.name){case"engine_channel:subscription_succeeded":return this.subscribed=!0,this.users.setUsers(a.data),this.trigger("engine:subscription_succeeded",this.users);case"engine_channel:subscription_error":return this.subscribed=!1,this.trigger("engine:subscription_error",a.data);case"engine_channel:user_added":return c=this.users.addUser(a.data),this.trigger("engine:user_added",c);case"engine_channel:user_removed":if(d=this.users.removeUser(a.data))return this.trigger("engine:user_removed",d);break;default:return b.__super__.handleEvent.call(this,a)}},b.prototype.disconnect=function(){return this.users.reset(),b.__super__.disconnect.call(this)},b}(e),b.exports=d},{"./privateChannel":5,"./users":6}],5:[function(a,b,c){"use strict";var d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;d=a("./channel"),f=a("../utils/requester"),g=a("../utils"),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype._authorize=function(a){return this.engine.authorizer.authorize({},{channelName:this.name},a)},b}(d),b.exports=e},{"../utils":31,"../utils/requester":33,"./channel":2}],6:[function(a,b,c){"use strict";var d;d=function(){function a(){this.reset()}return a.prototype.reset=function(){return this._users={},this.count=0,this._myId=null,this.me=null},a.prototype._formatUser=function(a){return{id:null!=a?a.userId:void 0,info:null!=a?a.userInfo:void 0}},a.prototype.setMyId=function(a){return this._myId=a},a.prototype.setUsers=function(a){var b,c,d;for(this._users={},this.count=0,b=0,c=a.length;c>b;b++)d=a[b],this._users[d.userId]=this._formatUser(d),this.count++;return this.me=this.get(this._myId)},a.prototype.addUser=function(a){return this._users[a.userId]||this.count++,this._users[a.userId]=this._formatUser(a),this.get(a.userId)},a.prototype.removeUser=function(a){return a=this._users[a.userId],a&&(delete this._users[a.userId],this.count--),a},a.prototype.each=function(a){var b,c,d,e;b=this._users,c=[];for(e in b)d=b[e],c.push(a(d));return c},a.prototype.get=function(a){return this._users[a]},a}(),b.exports=d},{}],7:[function(a,b,c){"use strict";var d,e,f,g,h,i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;h=a("debug")("engine:chat:confirmAlert"),g=a("../chatManagerUtil"),f=a("../../utils/promise"),e=a("./eventAlert"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return i(b,a),b.prototype.accept=function(a){var b;return a.alertId=this.alertId,a.alertType=function(){switch(this.type){case"group:joinInvitation:new":return"group:joinInvitation:accepted"}}.call(this),b=g.getPromiseOption(a),this._accept(b).then(function(b){return function(){var c;return(null!=(c=b.engine.options.chat)?c.enableCache:void 0)?b._updateCacheWithStatus("processed"):"function"==typeof a.onSuccess?a.onSuccess():void 0}}(this)).then(function(){return"function"==typeof a.onSuccess?a.onSuccess():void 0})["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},b.prototype.reject=function(a){var b;return a.alertId=this.alertId,a.alertType=function(){switch(this.type){case"group:joinInvitation:new":return"group:joinInvitation:rejected"}}.call(this),b=g.getPromiseOption(a),this._reject(b).then(function(b){return function(){var c;return(null!=(c=b.engine.options.chat)?c.enableCache:void 0)?b._updateCacheWithStatus("processed"):"function"==typeof a.onSuccess?a.onSuccess():void 0}}(this)).then(function(){return"function"==typeof a.onSuccess?a.onSuccess():void 0})["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},b.prototype._accept=function(a){return this.engine.chatManager.request("engine_chat:alert:accept",a)},b.prototype._reject=function(a){return this.engine.chatManager.request("engine_chat:alert:reject",a)},b}(e),f.toPromise(d),b.exports=d},{"../../utils/promise":32,"../chatManagerUtil":10,"./eventAlert":8,debug:38}],8:[function(a,b,c){"use strict";var d,e,f,g;g=a("debug")("engine:chat:eventAlert"),f=a("../chatManagerUtil"),e=a("../../utils/promise"),d=function(){function a(a,b){this.engine=b,this.alertId=a.alertId,this.from=a.from,this.to=a.to,this.group=a.group,this.type=a.type,this.status=a.status,this.lastActiveAt=a.lastActiveAt}return a.prototype._updateCacheWithStatus=function(a){var b;return null!=(b=this.engine.chatManager.dbUtil)?b.openDB().then(function(b){return function(c){var d;return d={alertId:b.alertId,from:b.from,to:b.to,type:b.type,group:b.group,status:a,lastActiveAt:b.lastActiveAt},c.alerts.update(d)}}(this)):void 0},a.prototype.ignore=function(a){var b;return a.alertId=this.alertId,b=f.getPromiseOption(a),this._ignore(b).then(function(b){return function(){var c;return(null!=(c=b.engine.options.chat)?c.enableCache:void 0)?b._updateCacheWithStatus("processed"):"function"==typeof a.onSuccess?a.onSuccess():void 0}}(this)).then(function(){return"function"==typeof a.onSuccess?a.onSuccess():void 0})["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},a.prototype._ignore=function(a){return this.engine.chatManager.request("engine_chat:alert:ignore",a)},a}(),e.toPromise(d,null,["_updateCacheWithStatus"]),b.exports=d},{"../../utils/promise":32,"../chatManagerUtil":10,debug:38}],9:[function(a,b,c){"use strict";var d,e,f,g,h;h=a("debug")("engine:chat:alerts"),g=a("../chatManagerUtil"),f=a("../../utils/promise"),e=a("./confirmAlert"),d=function(){function a(a){this.engine=a}return a.prototype._loadWithCache=function(a){return this.engine.chatManager.dbUtil.getDataAfterMerged("alerts").then(function(a){return h("load alerts with cache",a),a.newestDatas})},a.prototype.load=function(a){var b,c,d;return b=(null!=(d=this.engine.options.chat)?d.enableCache:void 0)?this._loadWithCache:this._getAlerts,c=g.getPromiseOption(a),b.call(this,c).then(function(b){return function(c){var d,f;return f=function(){var a,b,f;for(f=[],a=0,b=c.length;b>a;a++)d=c[a],"pending"===d.status&&f.push(new e(d,this.engine));return f}.call(b),"function"==typeof a.onSuccess?a.onSuccess(f):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},a.prototype.formatEventData=function(a){var b;return b=new e(a,this.engine),b._updateCacheWithStatus("pending"),b},a.prototype._getAlerts=function(a){return this.engine.chatManager.request("engine_chat:alert:get",a)},a}(),f.toPromise(d,null,["_loadWithCache","formatEventData"]),b.exports=d},{"../../utils/promise":32,"../chatManagerUtil":10,"./confirmAlert":7,debug:38}],10:[function(a,b,c){"use strict";var d,e;d=a("../utils/promise"),e=a("../protocol"),c._separateOptionsAndHandlers=function(a){var b,c,d,e;d={},b={};for(c in a)e=a[c],"function"==typeof e?b[c]=e:d[c]=e;return[d,b]},c.getPromiseOption=function(a){var b,d,e;return e=c._separateOptionsAndHandlers(a),d=e[0],b=e[1],d}},{"../protocol":29,"../utils/promise":32}],11:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},n={}.hasOwnProperty;l=a("debug")("engine:chat:ChatConversation"),g=a("../messages"),k=a("../chatManagerUtil"),f=a("../uploader/imageUploader"),j=a("../uploader/voiceUploader"),i=a("../uploader/videoUploader"),e=a("../../utils/eventEmitter"),h=a("../../utils/promise"),d=function(a){function b(a,b,c){var d;null==a&&(a={}),this.engine=b,null==c&&(c=!1),this.type=a.type,this.target=a.target,this.unreadMessageCount=a.unreadMessageCount,this.lastActiveAt=a.lastActiveAt,this.lastMessage=a.lastMessage,this.extra=a.extra,null==this.unreadMessageCount&&(this.unreadMessageCount=0),c&&(this.isTemporary=!0),this.lastActiveAt||(this.lastActiveAt=(new Date).toISOString()),this.messages=new g(this.engine),(null!=(d=this.engine.options.chat)?d.enableMediaMessage:void 0)&&(this.imageUploader=new f(this.engine),this.voiceUploader=new j(this.engine),this.videoUploader=new i(this.engine))}return m(b,a),b.prototype.loadMessages=function(a){return null==a&&(a={}),a.type=this.type,a.target=this.target,this.messages.load(a)},b.prototype.resetUnread=function(){return this.unreadMessageCount=0,this._resetUnread({type:this.type,target:this.target}),this.updateCache()},b.prototype.updateCache=function(a){var b,c;return null!=a&&(this.unreadMessageCount=a.unreadMessageCount,this.lastActiveAt=a.lastActiveAt,this.lastMessage=a.lastMessage,this.extra=a.extra),(null!=(b=this.engine.options.chat)?b.enableCache:void 0)&&!this.isTemporary&&null!=(c=this.engine.chatManager.dbUtil)?c.openDB().then(function(a){return function(b){var c,d;return c={type:a.type,target:a.target,unreadMessageCount:a.unreadMessageCount,lastMessage:a.lastMessage,lastActiveAt:a.lastActiveAt,extra:a.extra},l("update conversation cache",c),null!=(d=b.conversations)?d.update(c):void 0}}(this)):void 0},b.prototype.sendMessage=function(a){var b,c,d;return d=k._separateOptionsAndHandlers(a),b=d[0],c=d[1],c.type=this.type,c.to=this.target,null==c.content&&(c.content=b),this.messages.send(c)},b.prototype["delete"]=function(a){return this._deleteConversation({type:this.type,target:this.target}).then(function(b){return function(c){var d,e;return b.engine.chatManager.conversations.removeConversationFromBuffer(b.target),(null!=(d=b.engine.options.chat)?d.enableCache:void 0)?null!=(e=b.engine.chatManager.dbUtil)?e.openDB().then(function(c){return c.conversations.remove(b.target),"function"==typeof a.onSuccess?a.onSuccess():void 0}):void 0:"function"==typeof a.onSuccess?a.onSuccess():void 0}}(this))},b.prototype.getImageUploader=function(a){var b;return null==a&&(a={}),(null!=(b=this.engine.options.chat)?b.enableMediaMessage:void 0)?null==a.browseButton||""===a.browseButton?a.onError("BrowseButton does not exist"):this.imageUploader.init({browseButton:a.browseButton,dropElement:a.dropElement,target:this.target,type:this.type,extra:a.extra}).then(function(b){return function(){return"function"==typeof a.onSuccess?a.onSuccess(b.imageUploader):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0}):a.onError("You must set enableMediaMessage")},b.prototype.getVoiceUploader=function(a){var b;return null==a&&(a={}),(null!=(b=this.engine.options.chat)?b.enableMediaMessage:void 0)?this.voiceUploader.init({target:this.target,type:this.type,extra:a.extra}).then(function(b){return function(){return"function"==typeof a.onSuccess?a.onSuccess(b.voiceUploader):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0}):a.onError("You must set enableMediaMessage")},b.prototype.getVideoUploader=function(a){var b;return null==a&&(a={}),(null!=(b=this.engine.options.chat)?b.enableMediaMessage:void 0)?this.videoUploader.init({target:this.target,type:this.type,extra:a.extra}).then(function(b){return function(){return"function"==typeof a.onSuccess?a.onSuccess(b.videoUploader):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0}):a.onError("You must set enableMediaMessage")},b.prototype._deleteConversation=function(a){return this.engine.chatManager.request("engine_chat:conversation:delete",a)},b.prototype._resetUnread=function(a){return this.engine.chatManager.request("engine_chat:conversation:resetUnread",a)},b}(e),h.toPromise(d,null,["updateCache"]),b.exports=d},{"../../utils/eventEmitter":30,"../../utils/promise":32,"../chatManagerUtil":10,"../messages":18,"../uploader/imageUploader":20,"../uploader/videoUploader":22,"../uploader/voiceUploader":23,debug:38}],12:[function(a,b,c){"use strict";var d,e,f,g,h,i;i=a("debug")("engine:chat:conversations"),e=a("./chatConversation"),h=a("../chatManagerUtil"),g=a("../../utils/promise"),f=a("../../utils/eventEmitter"),d=function(){function a(a){this.engine=a,this.initConversationBuffer()}return a.prototype.initConversationBuffer=function(){var a,b,c;b=null!=this._store;for(c in b)a=b[c],a.removeAllListeners();return this._store={}},a.prototype.removeConversationFromBuffer=function(a){var b;return null!=(b=this._store[a])&&b.removeAllListeners(),delete this._store[a]},a.prototype._loadWithCache=function(a){return this.engine.chatManager.dbUtil.getDataAfterMerged("conversations").then(function(a){return function(b){var c,d,e,f,g,h;for(i("load conversations with cache",b),f=b.mergedDatas,d=0,e=f.length;e>d;d++)c=f[d],null!=(g=a._store[c.target])&&(g.isTemporary=!1),null!=(h=a._store[c.target])&&h.updateCache(c);return b.newestDatas.filter(function(a){return!a.isRemoved})}}(this))},a.prototype._loadOneWithoutCache=function(a){var b;return b=h.getPromiseOption(a),this._getConversations(b).then(function(a){return(null!=a?a.length:void 0)>0?a[0]:b})},a.prototype._loadOneWithCache=function(a){var b;return null!=(b=this.engine.chatManager.dbUtil)?b.openDB().then(function(b){return b.conversations.query("target").only(a.target).execute()}).then(function(b){return function(c){var d,e;return c.length>0?c[0]:(d=null,e=h.getPromiseOption(a),b._getConversations(e).then(function(a){var b;return(null!=a?a.length:void 0)>0?(b=a[0],b.isNew=!0,b):(b=e,b.isTemporary=!0,b)}))}}(this)):void 0},a.prototype.load=function(a){var b,c,d;return null==a&&(a={}),b=(null!=(d=this.engine.options.chat)?d.enableCache:void 0)?this._loadWithCache:this._getConversations,c=h.getPromiseOption(a),b.call(this,c).then(function(b){return function(c){var d,f,g,h,i,j;for(g=[],h=0,i=c.length;i>h;h++)f=c[h],null==(d=b._store)[j=f.target]&&(d[j]=new e(f,b.engine)),g.push(b._store[f.target]);return"function"==typeof a.onSuccess?a.onSuccess(g):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},a.prototype.loadOne=function(a){var b,c,d;return a.target?null!=this._store[a.target]?a.onSuccess(this._store[a.target]):(b=(null!=(d=this.engine.options.chat)?d.enableCache:void 0)?this._loadOneWithCache:this._loadOneWithoutCache,c=h.getPromiseOption(a),null!=b?b.call(this,c).then(function(b){return function(c){var d,f;return null!=c?(null==(d=b._store)[f=c.target]&&(d[f]=new e(c,b.engine,c.isTemporary)),c.isNew&&b._store[c.target].updateCache(),"function"==typeof a.onSuccess?a.onSuccess(b._store[c.target]):void 0):a.onSuccess()}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0}):void 0):a.onError("target is required")},a.prototype.handleEvent=function(a){var b,c,d;switch(i("Conversation handleEvent dispatcher",a),a.name){case"message:new":if(b="singleChat"===a.data.type?this._store[a.data.from]:this._store[a.data.to],!b)return;return b.lastMessage=a.data,b.unreadMessageCount++,b.lastActiveAt=a.data.createdAt,b.updateCache(),(null!=(c=this.engine.options.chat)?c.enableCache:void 0)?null!=(d=this.engine.chatManager.dbUtil)?d.openDB().then(function(c){var d;return d=a.data,d.id=d.from+d.to+d.messageId,d.target=b.target,c.messages.update(d).then(function(){return b.trigger(a.name,a.data)})}):void 0:b.trigger(a.name,a.data)}},a.prototype._getConversations=function(a){return this.engine.chatManager.request("engine_chat:conversation:get",a)},a}(),g.toPromise(d,["load","loadOne","_getConversations"]),b.exports=d},{"../../utils/eventEmitter":30,"../../utils/promise":32,"../chatManagerUtil":10,"./chatConversation":11,debug:38}],13:[function(a,b,c){"use strict";var d,e,f,g,h,i;g=a("debug")("engine:chat:dbUtil"),h=a("../utils/requester/loadJS"),e=a("../utils/promise"),i={conversations:{key:{keyPath:"target"},indexes:{lastActiveAt:{},target:{}}},messages:{key:{keyPath:"id"},indexes:{messageId:{},createdAt:{},from:{},to:{},type:{},target:{}}},groups:{key:{keyPath:"groupId"},indexes:{lastActiveAt:{},groupId:{},isRemoved:{}}},alerts:{key:{keyPath:"alertId"},indexes:{lastActiveAt:{},from:{},group:{},alertId:{},status:{},to:{},type:{}}},tmpMessages:{key:{keyPath:"id",autoIncrement:!0},indexes:{messageId:{},createdAt:{},from:{},to:{},type:{},target:{}}}},f=2,d=function(){function a(a){this.engine=a}return a.prototype.handelDbException=function(a,b){var c,d;return console.warn(a),null!=(c=this.server)&&"function"==typeof c.close&&c.close(),this.server=null,null!=b&&g(b),null!=(d=this.engine.options.chat)?d.enableCache=!1:void 0},a.prototype.initLocalDB=function(){return this.openDB()["catch"](function(a){return function(b){return a.handelDbException("Your browser does not support local storage",b),e.resolve()}}(this))},a.prototype.openDB=function(){var a,b,c,d;if(!(null!=(b=this.engine.options.chat)?b.enableCache:void 0))return e.reject("You must set enableCache");if(a=this.engine.chatManager.user.userId,!a)return e.reject("You must login firstly.");if("chatManagerDB-"+a===this.dbName){if(this.server)return e.resolve(this.server)}else null!=(c=this.server)&&c.close();return g("Switch db",this.dbName+(" -> chatManagerDB-"+a)),this.dbName="chatManagerDB-"+a,d=this,new e(function(a,b){return h.require("enableCache",d.engine.options.basePath).then(function(){return db.open({server:d.dbName,version:f,schema:i})}).then(function(c){return null==c.conversations?(d.handelDbException("Can not open db, you can try again after cleaned cache"),b()):(d.server=c,a(c))})["catch"](function(a){return d.handelDbException("Your browser does not support local storage",a),b(a)})})},a.prototype.clearCache=function(){var a,b,c,d,e,f,h;if((null!=(a=this.engine)&&null!=(b=a.options.chat)?b.enableCache:void 0)&&this.server)return g("clean cache",this.dbName),null!=(c=this.server.messages)&&c.clear(),null!=(d=this.server.conversations)&&d.clear(),null!=(e=this.server.groups)&&e.clear(),null!=(f=this.server.alerts)&&f.clear(),null!=(h=this.server)&&"function"==typeof h.close&&h.close(),this.server=null,"undefined"!=typeof indexedDB&&null!==indexedDB?indexedDB.deleteDatabase(this.dbName):void 0},a.prototype.getRemoteData=function(a,b){var c,d;return null==b&&(b={}),c={conversations:"engine_chat:conversation:get",alerts:"engine_chat:alert:get",groups:"engine_chat:group:get",messages:"engine_chat:message:get"},c[a]?("message"===a&&(d=!0),new e(function(e){return function(f,g){return b.onSuccess=function(b){return"messages"===a&&(b.id=b.from+b.to+b.messageId),f(b)},b.onError=function(a){return g(a)},e.engine.chatManager.request(c[a],b,d)}}(this))):e.resolve([])},a.prototype.match=function(a){return function(b){var c,d;for(c in a)if(d=a[c],"lastActiveAt"!==c&&null!=b[c]&&b[c]!==d)return!1;return!0}},a.prototype.getDataAfterMerged=function(a,b){var c;return null==b&&(b={}),c={},this.openDB().then(function(d){return function(e){return c.db=e,c.db[a].query("lastActiveAt").filter(d.match(b)).desc().execute()}}(this)).then(function(d){return function(e){var f;return null==e&&(e=[]),c.data=e,null!=(null!=(f=e[0])?f.lastActiveAt:void 0)&&(b.lastActiveAt=e[0].lastActiveAt),d.getRemoteData(a,b)}}(this)).then(function(b){var d,f,g,h;for(null==b&&(b=[]),c.remoteDatas=b,g=[],d=0,f=b.length;f>d;d++)h=b[d],g.push(c.db[a].update(h));return e.all(g)}).then(function(d){return function(){return c.db[a].query("lastActiveAt").filter(d.match(b)).desc().execute()}}(this)).then(function(a){return null==a&&(a=[]),{newestDatas:a,mergedDatas:c.remoteDatas}})},a}(),b.exports=d},{"../utils/promise":32,"../utils/requester/loadJS":35,debug:38}],14:[function(a,b,c){"use strict";var d,e,f,g,h;h=a("debug")("engine:chat:group"),f=a("../users"),g=a("../chatManagerUtil"),e=a("../../utils/promise"),d=function(){function a(a,b){this.engine=b,this.groupId=a.groupId,this.owner=a.owner,this.isPublic=a.isPublic,this.userCanInvite=a.userCanInvite,this.userCount=a.userCount,this.userCountLimit=a.userCountLimit,this.isRemoved=a.isRemoved,this.lastActiveAt=a.lastActiveAt,this.users=new f(this.engine)}return a.prototype.loadUsers=function(a){return a.groupId=this.groupId,this.users.loadGroupUsers(a)},a.prototype.inviteUsers=function(a){return a.groupId=this.groupId,this._inviteUsers(a)},a.prototype.removeUsers=function(a){return a.groupId=this.groupId,this._removeUsers(a)},a.prototype.leave=function(a){var b;return null==a&&(a={}),a.groupId=this.groupId,b=g.getPromiseOption(a),this._leaveGroup(b).then(function(b){return function(){var c,d;return b.engine.chatManager.conversations.removeConversationFromBuffer(b.groupId),(null!=(c=b.engine.options.chat)?c.enableCache:void 0)?null!=(d=b.engine.chatManager.dbUtil)?d.openDB().then(function(a){return e.all([a.conversations.remove(b.groupId),a.groups.remove(b.groupId)])}).then(function(){return"function"==typeof a.onSuccess?a.onSuccess():void 0})["catch"](function(){return"function"==typeof a.Error?a.Error():void 0}):void 0:"function"==typeof a.onSuccess?a.onSuccess():void 0}}(this))["catch"](function(b){return"function"==typeof a.Error?a.Error(b):void 0})},a.prototype._inviteUsers=function(a){return this.engine.chatManager.request("engine_chat:group:joinInvitation:send",a)},a.prototype._removeUsers=function(a){return this.engine.chatManager.request("engine_chat:group:removeUsers",a)},a.prototype._leaveGroup=function(a){return this.engine.chatManager.request("engine_chat:group:leave",a)},a}(),e.toPromise(d,null,["updateCache"]),b.exports=d},{"../../utils/promise":32,"../chatManagerUtil":10,"../users":24,debug:38}],15:[function(a,b,c){"use strict";var d,e,f,g,h;h=a("debug")("engine:chat:groups"),g=a("../chatManagerUtil"),e=a("./chatGroup"),f=a("../../utils/promise"),d=function(){function a(a){this.engine=a}return a.prototype._loadWithCache=function(a){var b;return b={},this.engine.chatManager.dbUtil.getDataAfterMerged("groups",a).then(function(a){return function(c){var d;return h("load groups with cache",c),b.data=c,null!=(d=a.engine.chatManager.dbUtil)?d.openDB():void 0}}(this)).then(function(a){var c,d,e,f,g;for(d=b.data.newestDatas,g=d.slice(1),e=0,f=g.length;f>e;e++)c=g[e],c.isRemoved&&a.groups.remove(c.groupId);return d.filter(function(a){return!a.isRemoved})})},a.prototype.load=function(a){var b,c,d;return null==a&&(a={}),b=(null!=(d=this.engine.options.chat)?d.enableCache:void 0)?this._loadWithCache:this._getGroups,c=g.getPromiseOption(a),b.call(this,c).then(function(b){return function(c){var d,f;return f=function(){var a,b,f;for(f=[],a=0,b=c.length;b>a;a++)d=c[a],f.push(new e(d,this.engine));return f}.call(b),"function"==typeof a.onSuccess?a.onSuccess(f):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},a.prototype.create=function(a){var b;return b=g.getPromiseOption(a),this._createGroup(b).then(function(a){return function(b){return a._getGroups({groupId:b.groupId})}}(this)).then(function(b){return function(c){var d,f,g;if(("undefined"!=typeof grups&&null!==grups?grups.length:void 0)<0)throw new Error("create group failed");return(null!=(f=b.engine.options.chat)?f.enableCache:void 0)&&null!=(g=b.engine.chatManager.dbUtil)&&g.openDB().then(function(a){var b;return null!=(b=a.groups)?b.update(c[0]):void 0}),d=new e(c[0]),"function"==typeof a.onSuccess?a.onSuccess(d):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},a.prototype._getGroups=function(a){return this.engine.chatManager.request("engine_chat:group:get",a)},a.prototype._createGroup=function(a){return this.engine.chatManager.request("engine_chat:group:create",a)},a}(),f.toPromise(d,null,["_loadWithCache"]),b.exports=d},{"../../utils/promise":32,"../chatManagerUtil":10,"./chatGroup":14,debug:38}],16:[function(a,b,c){"use strict";var d,e,f,g;e=a("../../utils/promise"),f=a("debug")("engine:chat:locationHelper"),d=function(){function a(){}return a.prototype.getLocation=function(a){var b,c,d;return("undefined"!=typeof navigator&&null!==navigator?navigator.geolocation:void 0)?(d=function(b){var c;return c={lat:b.coords.latitude,lng:b.coords.longitude},a.onSuccess(c)},c=function(b){return a.onError(b)},b={enableHighAccuracy:!0,timeout:5e3,maximumAge:3e4},navigator.geolocation.getCurrentPosition(d,c,b)):a.onError("Geolocation is not supported by this browser.")},a}(),e.toPromise(d,["getLocation"]),g=new d,b.exports=g},{"../../utils/promise":32,debug:38}],17:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p=function(a,b){return function(){return a.apply(b,arguments)}},q=function(a,b){function c(){this.constructor=a}for(var d in b)r.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},r={}.hasOwnProperty;n=a("debug")("engine:chat:chatManager"),l=a("../protocol"),f=a("./conversations"),i=a("./groups"),d=a("./alerts"),k=a("../utils/promise"),m=a("./chatManagerUtil"),g=a("./dbUtil"),j=a("./helpers/locationHelper"),o=a("../utils/requester/loadJS"),h=a("../utils/eventEmitter"),e=function(a){function b(a){var b;this.engine=a,this.request=p(this.request,this),this._handleOptions=p(this._handleOptions,this),this._handleOptions(),this._loginOptions=null,this.user=null,this.state="initialized",this.noConnectionOperations=[],this.conversations=new f(this.engine),this.groups=new i(this.engine),this.alerts=new d(this.engine),this.locationHelper=j,this.supportOffline=(null!=(b=this.engine.options)?b.supportOffline:void 0)||!1}return q(b,a),b.prototype._handleOptions=function(){var a,b,c,d,e;if(n("handle options",this.engine.options),(null!=(c=this.engine.options)?c.chat:void 0)&&(b=[],this.engine.options.chat&&"undefined"!=typeof window&&null!==window)){d=this.engine.options.chat;for(a in d)e=d[a],this.engine.options.chat[a]&&b.push(o.require(a,this.engine.options.basePath));return k.all(b).then(function(a){return n("load extension over",a),a})}},b.prototype.login=function(a){var b;return null==a&&(a={}),this.state="loggingIn",this._loginOptions=a,"connected"===this.engine.connection.state?(a.authData||(a.authData=null!=(b=this.engine.options)?b.authData:void 0),this.engine.authorizer.authorize(a,{chatLogin:!0},function(a){return function(b,c){var d;if(b)return a.state="failed",a.trigger("login:failed",b);d=a.user;try{a.user=JSON.parse(c.userData)}catch(e){}return a.engine.connection.sendEvent("engine_chat:user:login",c,function(b,c){var e,f,h,i;if(b){if(b.code===l.responseErrors.noConnection)return;return n("login error",b),a.state="failed",a.trigger("login:failed",b)}for(e in c)i=c[e],a.user[e]=i;return a.state="loggedIn",(null!=d?d.userId:void 0)===(null!=(f=a.user)?f.userId:void 0)?a.handleNoConnectionOperations():null!=d&&a.handleNoConnectionOperations(!0),(null!=(h=a.engine.options.chat)?h.enableCache:void 0)?(null==a.dbUtil&&(a.dbUtil=new g(a.engine)),a.dbUtil.initLocalDB().then(function(){return a.trigger("login:succeeded",c)})):a.trigger("login:succeeded"),n("login succeeded",c)})}}(this))):void 0},b.prototype.autoLogin=function(){return this._loginOptions?this.login(this._loginOptions):void 0},b.prototype.logout=function(a){var b,c,d;return this._loginOptions=null,d=m._separateOptionsAndHandlers(a),a=d[0],c=d[1],b=this.engine.connection.sendEvent("engine_chat:user:logout",function(a){return function(d){return d?d.code===l.responseErrors.noConnection.code?(a.bufferNoConnectionOperations("engine_chat:user:logout",null,b),a.state="loggedOut","function"==typeof c.onSuccess?c.onSuccess():void 0):(n("logout error",d),"function"==typeof c.onError?c.onError(d):void 0):(a.handleNoConnectionOperations(!0),a.state="loggedOut",a.conversations.initConversationBuffer(),a.user=null,n("logout succeeded"),"function"==typeof c.onSuccess?c.onSuccess():void 0)}}(this))},b.prototype.handleEvent=function(a){
var b;switch(b=a.name.replace("engine_chat:",""),a.name=b,a.data=this.formatEventData(a),this.trigger(b,a.data),a.name){case"message:new":return this.conversations.handleEvent(a),this.engine.connection.sendResponseEvent(a.id);case"alert:new":return this.engine.connection.sendResponseEvent(a.id)}},b.prototype.formatEventData=function(a){return"alert:new"===a.name?this.alerts.formatEventData(a.data):a.data},b.prototype.bufferNoConnectionOperations=function(a,b,c){var d,e;return c&&(null!=(e=this.user)?e.userId:void 0)?(null==this.noConnectionOperations&&(this.noConnectionOperations=[]),d={name:a,data:b,callback:c},n("buffer no connection operations",d),"engine_chat:message:send"!==a&&(d.timer=setTimeout(function(){var a;return a=l.responseErrors.requestTimeout,a.isFailed=!0,c(a),d.isTimeout=!0},6e4)),this.noConnectionOperations.push(d)):void 0},b.prototype.handleNoConnectionOperations=function(a){var b,c,d;if(!((null!=(d=this.noConnectionOperations)?d.length:void 0)<1&&this.handlingNoConnectionOperations)||a){for(this.handlingNoConnectionOperations=!0;c=this.noConnectionOperations.shift();)c.isTimeout||(null!=c.timer&&clearTimeout(c.timer),a?(b=l.responseErrors.noConnection,b.isFailed=!0,c.callback(b)):this.engine.connection.sendEvent(c.name,c.data,c.callback));return this.handlingNoConnectionOperations=!1}},b.prototype.clearCache=function(){var a,b;return(null!=(a=this.engine.options.chat)?a.enableCache:void 0)&&null!=(b=this.dbUtil)?b.clearCache():void 0},b.prototype.request=function(a,b,c){var d,e,f;return f=m._separateOptionsAndHandlers(b),b=f[0],e=f[1],"loggedIn"!==this.state?"function"==typeof e.onError?e.onError(l.responseErrors.unauthorized):void 0:(d=function(c){return function(f,g){var h;return f?f.code===l.responseErrors.noConnection.code&&!f.isFailed&&c.supportOffline?-1!==a.indexOf("get")&&(null!=(h=c.engine.options.chat)?h.enableCache:void 0)?e.onSuccess([]):c.bufferNoConnectionOperations(a,b,d):"function"==typeof e.onError?e.onError(f):void 0:"function"==typeof e.onSuccess?e.onSuccess(g):void 0}}(this),c&&(d.needSendAck=!0),this.engine.connection.sendEvent(a,b,d))},b.prototype.clearAllCache=function(){return n("clean all cache"),"undefined"!=typeof indexedDB&&null!==indexedDB&&"function"==typeof indexedDB.webkitGetDatabaseNames?indexedDB.webkitGetDatabaseNames().onsuccess=function(a,b){var c,d,e,f,g;for(f=a.target.result,g=[],c=0,d=f.length;d>c;c++)e=f[c],n("clean cache",e),e.indexOf(!1)?g.push("undefined"!=typeof indexedDB&&null!==indexedDB?indexedDB.deleteDatabase(e):void 0):g.push(void 0);return g}:void 0},b}(h),k.toPromise(e,["logout"]),b.exports=e},{"../protocol":29,"../utils/eventEmitter":30,"../utils/promise":32,"../utils/requester/loadJS":35,"./alerts":9,"./chatManagerUtil":10,"./conversations":12,"./dbUtil":13,"./groups":15,"./helpers/locationHelper":16,debug:38}],18:[function(a,b,c){"use strict";var d,e,f,g,h;h=a("debug")("engine:chat:messages"),g=a("../chatManagerUtil"),e=a("../../utils/promise"),f=a("./tmpMessage"),d=function(){function a(a){this.engine=a}return a.prototype._loadNewestMessages=function(a){var b,c,d;return h("load newest messages",a),b=a.limit||20,d={},null!=(c=this.engine.chatManager.dbUtil)?c.openDB().then(function(b){return function(c){return d.db=c,d.db.messages.query("messageId").filter(b.engine.chatManager.dbUtil.match({target:a.target,type:a.type})).desc().execute()}}(this)).then(function(b){return function(c){var e,f;return null==c&&(c=[]),h("get last local message",c[0]),e=(null!=(f=c[0])?f.messageId:void 0)+1||0,d.messagesResult=c,b._getMessages({type:a.type,target:a.target,endMessageId:e})}}(this)).then(function(c){return function(f){var g,i,j,k,l;for(h("get newest messages",f),g=0,i=f.length;i>g;g++)j=f[g],j.isNew=!0;return k=f.concat(d.messagesResult),l=c._loadMissingMessageBlocksPromises(k,a),e.all(l).then(function(a){var c,d,e,f,g;for(h("missing messages blocks:",a),c=0,e=a.length;e>c;c++)if(g=a[c],null!=g)for(d=0,f=g.length;f>d;d++)j=g[d],j.isNew=!0,k.push(j);return k.slice(0,+b+1||9e9)})}}(this)):void 0},a.prototype._loadMissingMessageBlocksPromises=function(a,b){var c,d;if(d=[],0===a.length)return d.push(this._getMessages({type:b.type,target:b.target,startMessageId:b.startMessageId,endMessageId:b.endMessageId,limit:b.limit||20})),d;for(b.startMessageId>a[0].messageId&&d.push(this._getMessages({type:b.type,target:b.target,startMessageId:b.startMessageId,endMessageId:a[0].messageId+1,limit:b.startMessageId-a[0].messageId})),b.endMessageId<a[a.length-1].messageId&&d.push(this._getMessages({type:b.type,target:b.target,startMessageId:a[a.length-1].messageId-1,endMessageId:b.endMessageId,limit:a[a.length-1].messageId-b.endMessageId})),c=0;c<a.length-1;)!function(a){return function(e){return e[c].messageId-e[c+1].messageId!==1?d.push(a._getMessages({type:b.type,target:b.target,startMessageId:e[c].messageId-1,endMessageId:e[c+1].messageId+1,limit:e[c].messageId-e[c+1].messageId})):void 0}}(this)(a),c++;return d},a.prototype._save=function(a,b){var c;return a instanceof Array||(a.isNew=!0,a=[a]),null!=(c=this.engine.chatManager.dbUtil)?c.openDB().then(function(c){var d,f,g,h;for(h=[],d=0,f=a.length;f>d;d++)g=a[d],g.isNew&&(g.target=b,g.id=g.from+g.to+g.messageId,h.push(c.messages.update(g)));return e.all(h)}):void 0},a.prototype._loadWithCache=function(a){var b,c;return null==a.startMessageId||null==a.endMessageId?this._loadNewestMessages(a):(b=a.limit||20,a.startMessageId||(a.startMessageId=a.endMessageId+b),a.endMessageId||(a.endMessageId=a.startMessageId-b),h("load with cache",a),null!=(c=this.engine.chatManager.dbUtil)?c.openDB().then(function(b){return function(c){return c.messages.query("messageId").bound(a.endMessageId,a.startMessageId).filter(b.engine.chatManager.dbUtil.match({target:a.target,type:a.type})).desc().execute()}}(this)).then(function(c){return function(d){var f;return h("local load",d),b=a.startMessageId-a.endMessageId+1,d.length===b?e.resolve(d):(f=c._loadMissingMessageBlocksPromises(d,a),e.all(f).then(function(a){var b,c,e,f,g,i;for(h("missing messages blocks:",a),b=0,e=a.length;e>b;b++)if(i=a[b],null!=i)for(c=0,f=i.length;f>c;c++)g=i[c],g.isNew=!0,d.push(g);return d}))}}(this)):void 0)},a.prototype.load=function(a){var b,c,d,i;return b=(null!=(i=this.engine.options.chat)?i.enableCache:void 0)?this._loadWithCache:this._getMessages,d=g.getPromiseOption(a),null==d.to&&(d.to=d.target),c=a.limit||20,b.call(this,d).then(function(b){return function(g){var i;return(null!=(i=b.engine.options.chat)?i.enableCache:void 0)?b._save(g,d.target).then(function(){var a;return null!=(a=b.engine.chatManager.dbUtil)?a.openDB():void 0}).then(function(c){return b.engine.options.supportOffline?c.tmpMessages.query("messageId").filter(b.engine.chatManager.dbUtil.match({target:a.target,type:a.type})).desc().execute():e.resolve([])}).then(function(d){var e,i,j,k,l,m,n;for(h("tmp messages",d),e=0,j=d.length;j>e;e++)m=d[e],n=new f(b.engine,m),"sending"===n.state&&n.retrySendMessage(),g.push(n);for(g.sort(function(a,b){var c;return c=b.messageId-a.messageId,0===c?(null!=b?b.id:void 0)-(null!=a?a.id:void 0):c}),i=0,k=g.length;k>i;i++)l=g[i],null==l.state&&(l.state="succeed");return"function"==typeof a.onSuccess?a.onSuccess(g.slice(0,+c+1||9e9)):void 0}):"function"==typeof a.onSuccess?a.onSuccess(g.slice(0,+c+1||9e9)):void 0}}(this))["catch"](function(b){return"function"==typeof a.onError?a.onError(b):void 0})},a.prototype.send=function(a){var b,c,d,e,i;return d=g.getPromiseOption(a),b=d,b.from=this.engine.chatManager.user.userId,c=void 0,(null!=(e=this.engine.options.chat)?e.enableCache:void 0)&&this.engine.options.supportOffline?(i=new f(this.engine,b),c=i.save().then(function(a){return function(){return a._sendMessage(d)}}(this))):c=this._sendMessage(d),c.then(function(c){return function(d){var e,f;return b.messageId=d.messageId,b.id=b.from+b.to+d.messageId,null!=d.content?b.content=d.content:b.content=a.content,(null!=(e=c.engine.options.chat)?e.enableCache:void 0)?null!=(f=c.engine.chatManager.dbUtil)?f.openDB().then(function(d){return c.engine.options.supportOffline?i.remove().then(function(){return h("removed tmpMessage",i.id),b.target=a.to,d.messages.update(b),"function"==typeof a.onSuccess?a.onSuccess(b):void 0}):(b.target=a.to,d.messages.update(b),"function"==typeof a.onSuccess?a.onSuccess(b):void 0)}):void 0:"function"==typeof a.onSuccess?a.onSuccess(b):void 0}}(this))["catch"](function(b){return function(c){var d,e;return(null!=(d=b.engine.options.chat)?d.enableCache:void 0)&&b.engine.options.supportOffline?(i.changState("failed"),null!=(e=b.engine.chatManager.dbUtil)?e.openDB().then(function(a){return a.tmpMessages.update(i.toJSON())}).then(function(){return null!=a&&"function"==typeof a.onError?a.onError(c):void 0}):void 0):null!=a&&"function"==typeof a.onError?a.onError(c):void 0}}(this))},a.prototype._sendMessage=function(a){return this.engine.chatManager.request("engine_chat:message:send",a)},a.prototype._getMessages=function(a){return this.engine.chatManager.request("engine_chat:message:get",a,!0)},a}(),e.toPromise(d,["send","load","_getMessages","_sendMessage"]),b.exports=d},{"../../utils/promise":32,"../chatManagerUtil":10,"./tmpMessage":19,debug:38}],19:[function(a,b,c){"use strict";var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("../../utils/eventEmitter"),e=function(b){function c(a,b){this.engine=a,null==b&&(b={}),this.changState=f(this.changState,this),this.messageId=b.messageId,this.createdAt=b.createdAt,this.from=b.from,this.to=b.to,this.type=b.type,this.content=b.content,this.state=b.state,this.target=b.target,this.id=b.id,null==this.state&&(this.state="sending"),null==this.target&&(this.target=this.to)}return g(c,b),c.prototype.save=function(){var a;return null!=(a=this.engine.chatManager.dbUtil)?a.openDB().then(function(a){return function(b){return null!=a.messageId?b.tmpMessages.add(a.toJSON()):b.messages.query("messageId").filter(a.engine.chatManager.dbUtil.match({target:a.target,type:a.type})).desc().execute().then(function(c){var d;return null==c&&(c=[]),a.messageId=(null!=(d=c[0])?d.messageId:void 0)||0,b.tmpMessages.add(a.toJSON())})}}(this)).then(function(a){return function(b){return a.id=b[0].id,a.toJSON()}}(this)):void 0},c.prototype.changState=function(a){var b,c,d;if("string"==typeof a)return c=[this.state,a],b=c[0],this.state=c[1],d={previous:b,current:this.state},this.trigger("state:changed",d)},c.prototype.toJSON=function(){var a;return a={messageId:this.messageId,createdAt:this.createdAt,from:this.from,to:this.to,type:this.type,state:this.state,content:this.content,target:this.target},this.id&&(a.id=this.id),a},c.prototype.remove=function(){var a;if(this.id)return null!=(a=this.engine.chatManager.dbUtil)?a.openDB().then(function(a){return function(b){return b.tmpMessages.remove(a.id)}}(this)):void 0},c.prototype.retrySendMessage=function(){return"succeeded"!==this.state?this.remove().then(function(b){return function(){var c,d;return c=a("../messages"),d=new c(b.engine),d.send({target:b.to,type:b.type,content:b.content,from:b.from,to:b.to})}}(this)).then(function(a){return function(b){return a.messageId=b.messageId,a.changState("succeeded"),a.toJSON()}}(this))["catch"](function(a){return function(){return a.changState("failed")}}(this)):void 0},c}(d),b.exports=e},{"../../utils/eventEmitter":30,"../messages":18}],20:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;f=a("debug")("engine:chat:ChatImageUploader"),e=a("./uploader"),d=function(a){function b(a){this.engine=a,b.__super__.constructor.call(this,this.engine)}return g(b,a),b.prototype.init=function(a){return a.messageType="image",b.__super__.init.call(this,a)},b}(e),b.exports=d},{"./uploader":21,debug:38}],21:[function(a,b,c){"use strict";var d,e,f,g,h,i,j=function(a,b){return function(){return a.apply(b,arguments)}},k=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},l={}.hasOwnProperty;h=a("debug")("engine:chat:ChatUploader"),e=a("../../utils/eventEmitter"),f=a("../messages"),i=a("../../utils/requester/loadJS"),g=a("../../utils/promise"),d=function(a){function b(a){this.engine=a,this._requestPermission=j(this._requestPermission,this),this._changstate=j(this._changstate,this),this.init=j(this.init,this),this._uploader={},this.state="initialized",this.messages=new f(this.engine)}return k(b,a),b.prototype.init=function(a){var b,c,d,e;return h("uploader init",a),(null!=(d=this.engine.options.chat)?d.enableMediaMessage:void 0)?(e=this,b=null!=a.browseButton?a.browseButton:"undefined"!=typeof document&&null!==document?document.createElement("input"):void 0,i.require("enableMediaMessage",this.engine.options.basePath).then(function(){return e._uploader=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:b,uptoken:e.engine.chatManager.user.uploadToken,domain:"domain",chunk_size:"4mb",dragdrop:!0,drop_element:a.dropElement,max_file_size:"100mb",save_key:!0,auto_start:!0,x_vars:{targetId:a.target},init:{FileUploaded:function(b,c,d){var f;switch(h("file uploaded, wait to send",d),e.trigger("upload:done",c,d),d=JSON.parse(d),f={content:{type:a.messageType,file:{key:d.key,name:d.fname,size:d.fsize,etag:d.etag,mimeType:d.mimeType}},type:a.type,to:a.target,from:e.engine.chatManager.user.userId},a.messageType){case"image":f.content.file.width=d.imageInfo.width,f.content.file.height=d.imageInfo.height;break;case"voice":f.content.file.duration=d.avinfo.audio.duration;break;case"video":f.content.file.width=d.avinfo.video.width,f.content.file.height=d.avinfo.video.height,f.content.file.duration=d.avinfo.video.duration||d.avinfo.format.duration}return e.trigger("message:sending",f),a.extra&&(f.extra=a.extra),e.messages.send(f).then(function(a){return a.createdAt=(new Date).toISOString(),a.state="sent",e.trigger("message:sent",a)})["catch"](function(a){return h("send message failed",a),e.trigger("message:sendFailed",a)})},Error:function(a,b,c){return h("init uploader failed",b,c),e.trigger("upload:error",b,c)}}}),e._uploader.bind("StateChanged",function(a){switch(a.state){case 1:return e._changstate("uploaded");case 2:return e._changstate("uploading")}})})["catch"](function(a){return h("Init uploader failed",a),e._changstate("failed"),e.trigger("failed",a)})):(c="if you want use getVideoUploader you must enableMediaMessage",this._changstate("failed"),this.trigger("failed",c),g.reject(c))},b.prototype._changstate=function(a){var b,c,d;if("string"==typeof a)return c=[this.state,a],b=c[0],this.state=c[1],d={previous:b,current:this.state},h("state changed",d),this.trigger("state:changed",d)},b.prototype.destroy=function(){var a,b,c;return(null!=(a=this.mediaConstraints)?a.video:void 0)&&(null!=(b=this.stream)&&b.stop(),this.recordRTC=null),null!=(c=this._uploader)&&c.destroy(),this.unbind()},b.prototype._requestPermission=function(a,b,c){var d,e,f,g;if(this.mediaConstraints){this._changstate("initializing"),g=function(d){return function(e){return d._changstate("initialized"),d.stream=e,d.recordRTC=RecordRTC(e,a),null!=d[b]?d[b](c):void 0}}(this),f=function(a){return function(b){return a._changstate("failed"),a.trigger("failed",b),console.warn("Can not open media!!!",b)}}(this);try{return navigator.getUserMedia(this.mediaConstraints,g,f)}catch(e){return d=e,this._onMediaError("Your browser does not support getUserMedia")}}},b}(e),b.exports=d},{"../../utils/eventEmitter":30,"../../utils/promise":32,"../../utils/requester/loadJS":35,"../messages":18,debug:38}],22:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;f=a("debug")("engine:chat:ChatVideoUploader"),d=a("./uploader"),e=function(a){function b(a){this.engine=a,this.getRealTimeData=g(this.getRealTimeData,this),this.send=g(this.send,this),this._stopHandler=g(this._stopHandler,this),this.stopRecord=g(this.stopRecord,this),this.startRecord=g(this.startRecord,this),this.requestPermission=g(this.requestPermission,this),b.__super__.constructor.call(this,this.engine),this.mediaConstraints={video:!0},this.isChrome="undefined"!=typeof navigator.webkitGetUserMedia,this.isChrome||(this.mediaConstraints.audio=!0)}return h(b,a),b.prototype.requestPermission=function(a,b){var c;return c={disableLogs:!0,type:"video",video:{width:320,height:240},canvas:{width:320,height:240}},this.isChrome||(c={disableLogs:!0}),this._requestPermission(c,a,b)},b.prototype.init=function(a){return a.messageType="video",b.__super__.init.call(this,a)},b.prototype.startRecord=function(a){var b,c;if("recording"!==(b=this.state)&&"uploading"!==b)return this.recordRTC?(this._changstate("recording"),this.trigger("record:started"),this.recordRTC.blob=null,this.duration=null,this.recordRTC.startRecording(),c=URL.createObjectURL(this.stream),a.src=c,a.autoplay=!0,this.startTime=(new Date).getTime(),this.recordTimer=setTimeout(function(a){return function(){return a.stopRecord()}}(this),6e4)):this.requestPermission("startRecord",a)},b.prototype.stopRecord=function(){return"recording"!==this.state?console.warn("You have to perform when you record."):this.recordRTC?(null!=this.recordTimer&&clearTimeout(this.recordTimer),this.recordRTC.stopRecording(function(a){return function(b){return a._changstate("recorded"),a.tmpVideoURL=b,a._stopHandler(b)}}(this))):this.requestPermission("stopRecord")},b.prototype._stopHandler=function(a){return this.duration||(this.duration=(new Date).getTime()-this.startTime),this.trigger("record:stop",a,this.duration)},b.prototype.send=function(){return"uploading"===this.state?console.warn("Please wait for the upload."):this.recordRTC?(null!=this.recordTimer&&clearTimeout(this.recordTimer),"recorded"===this.state?(this._uploader.addFile(this.recordRTC.getBlob()),void this._stopHandler(this.tmpVideoURL)):this.recordRTC.stopRecording(function(a){return function(b){var c;return c=a.recordRTC.getBlob(),null!=c&&a._uploader.addFile(c),a._stopHandler(b)}}(this))):this.requestPermission()},b.prototype.getRealTimeData=function(a){var b;return"recording"===this.state?console.warn("You must stop recording."):this.recordRTC?(this.recordRTC.startRecording(),b=URL.createObjectURL(this.stream),a.src=b,a.autoplay=!0):this.requestPermission("getRealTimeData",a)},b}(d),b.exports=e},{"./uploader":21,debug:38}],23:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;f=a("debug")("engine:chat:ChatVoiceUploader"),d=a("./uploader"),e=function(a){function b(a){this.engine=a,this.send=g(this.send,this),this._stopHandler=g(this._stopHandler,this),this.stopRecord=g(this.stopRecord,this),this.startRecord=g(this.startRecord,this),this.requestPermission=g(this.requestPermission,this),b.__super__.constructor.call(this,this.engine),this.mediaConstraints={audio:!0},this.isChrome="undefined"!=typeof navigator.webkitGetUserMedia}return h(b,a),b.prototype.requestPermission=function(a,b){var c;return c={disableLogs:!0},this.isChrome&&(c.compression=8),this._requestPermission(c,a,b)},b.prototype.init=function(a){return a.messageType="voice",b.__super__.init.call(this,a)},b.prototype.startRecord=function(){var a;if("recording"!==(a=this.state)&&"uploading"!==a)return this.recordRTC?(this._changstate("recording"),this.trigger("record:started"),this.recordRTC.blob=null,this.duration=null,this.recordRTC.startRecording(),this.startTime=(new Date).getTime(),this.recordTimer=setTimeout(function(a){return function(){return a.stopRecord()}}(this),6e4)):this.requestPermission("startRecord")},b.prototype.stopRecord=function(){return"recording"!==this.state?console.warn("You have to perform when you record."):this.recordRTC?this.recordRTC.stopRecording(function(a){return function(b){return a._changstate("recorded"),a._stopHandler()}}(this)):this.requestPermission("stopRecord")},b.prototype._stopHandler=function(){return null!=this.recordTimer&&clearTimeout(this.recordTimer),this.duration||(this.duration=(new Date).getTime()-this.startTime),this.trigger("record:stopped",this.recordRTC.getBlob(),this.duration)},b.prototype.send=function(){return"uploading"===this.state?console.warn("Please wait for the upload."):this.recordRTC?this.recordRTC.stopRecording(function(a){return function(b){var c;return c=a.recordRTC.getBlob(),null!=c&&a._uploader.addFile(c),a._stopHandler()}}(this)):this.requestPermission()},b}(d),b.exports=e},{"./uploader":21,debug:38}],24:[function(a,b,c){"use strict";var d,e,f,g;g=a("debug")("engine:chat:users"),f=a("../chatManagerUtil"),d=a("../../utils/promise"),e=function(){function a(a){this.engine=a}return a.prototype.loadGroupUsers=function(a){return this._getGroupUsers(a)},a.prototype._getGroupUsers=function(a){return this.engine.chatManager.request("engine_chat:group:getUsers",a)},a}(),d.toPromise(e),b.exports=e},{"../../utils/promise":32,"../chatManagerUtil":10,debug:38}],25:[function(a,b,c){(function(c){"use strict";var d,e,f,g,h,i,j,k=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},l={}.hasOwnProperty;i=a("debug")("engine:connection"),j=a("engine.io-client"),e=a("../utils/eventEmitter"),g=a("./serverAddrManager"),h=a("../utils"),f=a("../protocol"),d=function(a){function b(a){this.engine=a,this._serverAddrManager=new g(this.engine),this._updateState("initialized"),this._connect()}return k(b,a),b.prototype._updateState=function(a){var b;return b=this.state,a!==b?(this.state=a,c.nextTick(function(c){return function(){return c.trigger("state_changed",{previous:b,current:a}),c.trigger(a)}}(this))):void 0},b.prototype._handleConnectionEvent=function(a){switch(a.name){case"engine_connection:established":return this.socketId=this._socket.id,this._updateState("connected");case"engine_connection:error":return this._lastEngineError=a.data,this.trigger("error",{code:a.data.code,message:a.data.message})}},b.prototype._handleResponseEvent=function(a){var b;return(b=this._socket.pendingCallbacks[a.data.to])?(delete this._socket.pendingCallbacks[a.data.to],a.data.ok?(b(null,a.data.result),b.needSendAck?this.sendResponseEvent(a.id):void 0):b(a.data.error)):void 0},b.prototype._connect=function(a){var b,c,d,g,k,l,m,n,o,p;if(o=(null!=(m=this.engine.options)?m.serverAddr:void 0)||this._serverAddrManager.addr,!o)return this._socket=new e,this._serverAddrManager.refresh(),void this._serverAddrManager.bindOnce("refreshed",function(a){return function(b){return b?(a._lastEngineError=b,a._socket.emit("close"),a._socket=null):a._connect()}}(this));if(d=this._socket,this._socket=new j.Socket(o,{query:{appId:this.engine.appId,platform:h.getPlatform(),sdkVersion:this.engine.version,protocol:f.version}}),this._socket.pendingCallbacks={},p=(new Date).getTime(),this._socket.on("open",function(){var a;return a=(new Date).getTime(),i("socket open",a-p+"ms")}),this._socket.on("message",function(a){return function(b){var c,d,e;try{e=f.decodeEvent(b)}catch(d){return c=d,a.trigger("error",c)}return i("got event",e),f.connectionEventNamePattern.test(e.name)?a._handleConnectionEvent(e):f.responseEventNamePattern.test(e.name)?a._handleResponseEvent(e):a.trigger("event",e)}}(this)),this._socket.on("close",function(a){return function(b){var c,d,e;i("socket close",b),e=a._socket.pendingCallbacks;for(d in e)(c=e[d])(f.responseErrors.noConnection);return a._socket=null,a.socketId=null}}(this)),this._socket.on("error",function(a){return i("socket error",a)}),this._socket.on("upgradeError",function(a){return i("socket upgradeError",a)}),d){for(b=["open","message","close","error","flush","drain","upgradeError","upgrade"],n=[],g=0,k=b.length;k>g;g++)c=b[g],n.push(function(){var a,b,e,f;for(e=d.listeners(c),f=[],a=0,b=e.length;b>a;a++)l=e[a],f.push(this._socket.on(c,l));return f}.call(this));return n}},b.prototype.sendEvent=function(a,b,c){var d;return"function"==typeof b&&(c=b,b=null),"connected"!==this.state?c?setTimeout(function(){return c(f.responseErrors.noConnection)},0):!1:(null==this.eventId&&(this.eventId=0),this.eventId++,d=f.encodeEvent({id:this.eventId,name:a,data:b}),i("send event",{id:this.eventId,name:a,data:b}),this._socket.send(d),c?c?this._socket.pendingCallbacks[this.eventId]=c:void 0:!0)},b.prototype.sendResponseEvent=function(a,b,c){var d;return d={to:a},b?(d.ok=!1,d.err=b):(d.ok=!0,c&&(d.result=c)),this.sendEvent("engine_response",d)},b.prototype.disconnect=function(){var a;return null!=(a=this._socket)&&"function"==typeof a.close&&a.close(),this._updateState("disconnected")},b.prototype.connect=function(){return"disconnected"===this.state?this._connect():void 0},b}(e),b.exports=d}).call(this,a("_process"))},{"../protocol":29,"../utils":31,"../utils/eventEmitter":30,"./serverAddrManager":27,_process:78,debug:38,"engine.io-client":41}],26:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;f=a("debug")("engine:connection"),e=a("./connection"),d=function(a){function b(a){this.engine=a,b.__super__.constructor.call(this,this.engine),this._resetReconnectState()}return g(b,a),b.prototype._resetReconnectState=function(){return this._reconnectState={count:0,startTime:null,strategy:"backoff","in":0,inMax:1e4},null!=this._reconnectTimer?(clearTimeout(this._reconnectTimer),this._reconnectTimer=null):void 0},b.prototype._reconnect=function(a,b,c){var d,e,g,h,i,j,k;if("disconnected"!==(h=this.state)&&"failed"!==h&&!this._reconnectTimer){if(this._lastEngineError){if(g=this._lastEngineError,this._lastEngineError=null,4e3<=(i=g.code)&&4099>=i)return this._updateState("failed");if(4100<=(j=g.code)&&4199>=j)return g.reconnectRefreshServerAddr&&this._serverAddrManager.refresh(),this._reconnect(g.reconnectStrategy,g.reconnectIn,g.reconnectInMax);if(4200<=(k=g.code)&&4399>=k)return this._reconnect()}switch((e=this._reconnectState).startTime||(e.startTime=new Date),this._reconnectState.strategy=a||this._reconnectState.strategy,this._reconnectState["in"]=null!=b?b:this._reconnectState["in"],this._reconnectState.inMax=null!=c?c:this._reconnectState.inMax,this._reconnectState.strategy){case"backoff":d=this._reconnectState.count>0?2*this._reconnectState["in"]||1:this._reconnectState["in"],this._reconnectState["in"]=Math.min(this._reconnectState.inMax,d);break;case"static":this._reconnectState["in"]=null!=b?b:this._reconnectState["in"]}return this._reconnectTimer=setTimeout(function(a){return function(){return a._reconnectTimer=null,a._serverAddrManager.refresh(),a._connect(),a._reconnectState.count++}}(this),this._reconnectState["in"]),f("reconnect",this._reconnectState),this.trigger("connecting_in",this._reconnectState["in"]),this._updateState("connecting")}},b.prototype._connect=function(){return this._updateState("connecting"),b.__super__._connect.call(this),this._socket.on("open",function(a){return function(){return a._resetReconnectState()}}(this)),this._socket.on("close",function(a){return function(){return a._reconnect()}}(this))},b.prototype.disconnect=function(){return b.__super__.disconnect.call(this),this._resetReconnectState()},b}(e),b.exports=d},{"./connection":25,debug:38}],27:[function(a,b,c){"use strict";var d,e,f,g,h,i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;h=a("debug")("engine:connection:serverAddrManager"),d=a("../utils/eventEmitter"),f=a("../utils/requester"),e="https://api.tuisongbao.com:443/v2/sdk/engine/server",g=function(a){function b(a){this.engine=a,this._refreshing=!1}return i(b,a),b.prototype.refresh=function(){var a;if(!this._refreshing)return this.addr=null,this._refreshing=!0,a=(new Date).getTime(),f.getWithJSONPFallback(e,{appId:this.engine.appId},function(b){return function(c,d){var e;return e=(new Date).getTime(),h("Got server addr response",{err:c,res:d,elapsed:e-a+"ms"}),b._refreshing=!1,c?b.trigger("refreshed",c):(b.addr=d.addr,b.trigger("refreshed"))}}(this),this.engine.options)},b}(d),b.exports=g},{"../utils/eventEmitter":30,"../utils/requester":33,debug:38}],28:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n=[].slice;l=a("debug").log,a("debug").log=function(){var a,b,c;return b=1<=arguments.length?n.call(arguments,0):[],c=function(){var c,d,e;for(e=[],c=0,d=b.length;d>c;c++){a=b[c];try{a instanceof Error?e.push(a):e.push(JSON.stringify(a))}catch(f){e.push(a)}}return e}(),l.apply(this,c)},m=a("debug")("engine:index"),k=a("./utils"),g=a("./connection"),d=a("./authorizer"),e=a("./channels"),f=a("./chat"),j=a("./protocol"),i=a("./utils/promise"),h=function(){function b(a,b){this.appId=a,this.options=b,this.appId||k.throwError("appId is required."),this.version="v2.1.0",this.connection=new g(this),this.authorizer=new d(this),this.channels=new e(this),this.chatManager=new f(this),"undefined"!=typeof window&&null!==window&&null==window.Promise&&(window.Promise=i),this.connection.bind("state_changed",function(a){return m("connection state_changed",a)}),this.connection.bind("connecting_in",function(a){return m("connection connecting_in",a)}),this.connection.bind("connected",function(a){return function(){return a.channels.subscribeAll(),a.chatManager.autoLogin()}}(this)),this.connection.bind("event",function(a){return function(b){var c;return b.channel?(c=a.channels.find(b.channel),c.handleEvent(b)):j.chatEventNamePattern.test(b.name)?a.chatManager.handleEvent(b):void 0}}(this)),this.connection.bind("error",function(a){return m("connection error",a)}),this.connection.bind("disconnected",function(a){return function(){return a.chatManager.handleNoConnectionOperations(!0),a.channels.disconnect()}}(this))}return b.debug=a("debug"),b}(),"undefined"!=typeof window&&null!==window&&(window.Engine=h),b.exports=h},{"./authorizer":1,"./channels":3,"./chat":17,"./connection":26,"./protocol":29,"./utils":31,"./utils/promise":32,debug:38}],29:[function(a,b,c){"use strict";var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("../protocol"),f=a("./utils"),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b._throwError=f.throwError,b}(d),b.exports=e},{"../protocol":37,"./utils":31}],30:[function(a,b,c){"use strict";var d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("events"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.bind=function(){return this.on.apply(this,arguments)},b.prototype.bindOnce=function(){return this.once.apply(this,arguments)},b.prototype.unbind=function(a,b){return b?this.removeListener(a,b):this.removeAllListeners(a)},b.prototype.trigger=function(){return this.emit.apply(this,arguments)},b.prototype.handlers=function(){return this.listeners.apply(this,arguments)},b}(e.EventEmitter),b.exports=d},{events:77}],31:[function(a,b,c){(function(a){"use strict";var c;c=function(){function b(){}return b.createError=function(a){
var b;return b=new Error(a.message||a),b.name="EngineError",null==b.code&&(b.code=a.code||-1),b},b.throwError=function(a){throw b.createError(a)},b.genRandomStr=function(){var a,b,c;return b="abcdefghijklmnopqrstuvwxyz_",c=function(){var c,d;for(d=[],a=c=0;20>c;a=++c)d.push(b[Math.floor(Math.random()*b.length)]);return d}(),c.join("")},b.checkBrowser=function(){var a,b,c,d;return"undefined"==typeof window||null===window?function(){return{}}:(d=window.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(d)||/(opr)[\/]([\w.]+)/.exec(d)||/(chrome)[ \/]([\w.]+)/.exec(d),a||(a=/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)),a||(a=/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)),a||(a=/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)),a||(a=/(msie) ([\w.]+)/.exec(d)||d.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(d)),a||(a=d.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(d)||[]),b=/(ipad)/.exec(d)||/(ipod)/.exec(d)||/(iphone)/.exec(d)||/(kindle)/.exec(d),b||(b=/(silk)/.exec(d)||/(android)/.exec(d)||/(windows phone)/.exec(d)||/(win)/.exec(d)),b||(b=/(mac)/.exec(d)||/(linux)/.exec(d)||/(cros)/.exec(d)||/(playbook)/.exec(d)),b||(b=/(bb)/.exec(d)||/(blackberry)/.exec(d)||[]),c={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",versionNumber:a[4]||a[2]||"0",platform:b[0]||""},function(){return c})}(),b.getPlatform=function(){var b;return b="undefined"!=typeof window&&null!==window?window.navigator.userAgent:"Node.js "+a.version+"$"+a.platform+"$"+a.arch,function(){return b}}(),b}(),b.exports=c}).call(this,a("_process"))},{_process:78}],32:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n={}.hasOwnProperty;j=a("debug")("engine:promise"),h=a("../utils"),i=a("../chat/chatManagerUtil"),e=void 0,d=1,g=2,l=function(a){return"function"==typeof a},k=function(a){return"[object Array]"===Object.prototype.toString.call(a)},m=function(a){return a&&"function"==typeof a.then},f=function(){function a(b){var c,f;if(!l(b))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");return this instanceof a?(this._value,this._reason,this._status=e,this._resolveHandlers=[],this._rejectHandlers=[],f=function(a){return function(b){return a.transite(d,b)}}(this),c=function(a){return function(b){return a.transite(g,b)}}(this),void b(f,c)):new a(b)}return a.prototype.transite=function(a,b){return this._status===e?setTimeout(function(c){return function(){return c._status=a,c._publish(b)}}(this),0):void 0},a.prototype._publish=function(a){var b,c,e;if(e=this._status===d,c=this[e?"_resolveHandlers":"_rejectHandlers"],void 0!==c)for(;b=c.shift();)a=b.call(this,a)||a;return this[e?"_value":"_reason"]=a,this._resolveHandlers=this._rejectHandlers=void 0},a.prototype.then=function(b,c){var f;return f=this,new a(function(a,h){var i,j;return i=function(c){var d,e,f;try{return f=l(b)&&b(c)||c,m(f)?f.then(function(b){return a(b)},function(a){return h(a)}):a(f)}catch(e){return d=e,h(d)}},j=function(a){return a=l(c)&&c(a)||a,h(a)},f._status===e?(f._resolveHandlers.push(i),f._rejectHandlers.push(j)):f._status===d?i(f._value):f._status===g?j(f._reason):void 0})},a.prototype["catch"]=function(a){return this.then(void 0,a)},a.prototype.delay=function(b){return this.then(function(c){return a.delay(b,c)})},a}(),f.delay=function(a,b){return new f(function(c,d){var e,f;try{return setTimeout(function(){return c(b)},a)}catch(f){return e=f,d(e)}})},f.resolve=function(a){return new f(function(b,c){var d,e;try{return b(a)}catch(e){return d=e,c(d)}})},f.reject=function(a){return new f(function(b,c){var d,e;try{return c(a)}catch(e){return d=e,c(d)}})},f.all=function(a){if(!k(a))throw new TypeError("You must pass an array to all.");return new f(function(b,c){var d,e,f,g,h,i,j,k;if(d=0,j=[],e=a.length,0===e)return b([]);for(i=function(a){return function(b){return h(a,b)}},g=function(a){return c(a)},h=function(a,c){return j[a]=c,a===e-1?b(j):void 0},k=[];e>d;)null!=(f=a[d])&&"function"==typeof f.then&&f.then(i(d),g),k.push(d++);return k})},f.toPromise=function(a,b,c){var d,e,g,k;e=a.prototype,g=[];for(d in e)n.call(e,d)&&(k=e[d],l(k)&&"constructor"!==d&&((null!=b?b.indexOf(d):void 0)<0||(null!=c?c.indexOf(d):void 0)>-1||g.push(function(b,c){return a.prototype[b]=function(a){var d,e,g;return null==a&&(a={}),null!=a.onSuccess||null!=a.onError||"object"!=typeof a?("object"==typeof a&&l(a.onError)&&(d=a.onError,a.onError=function(a){return a=h.createError(a),j(b+":"+c,a),d(a)}),c.apply(this,arguments)):arguments.length>1?c.apply(this,arguments):(e=i.getPromiseOption(a),g=new f(function(a,d){return e.onSuccess=function(b){return a(b)},e.onError=function(a){return a=h.createError(a),j(b+":"+c,a),d(a)}}),c.call(this,e),g)}}(d,k))));return g},b.exports=f},{"../chat/chatManagerUtil":10,"../utils":31,debug:38}],33:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m;h=a("debug")("engine:utils:requester"),l=a("superagent"),j=a("./jsonpRequest"),m=a("./xmlHttpRequest"),f=a("../index"),g=f.checkBrowser(),k="msie"===g.browser&&parseFloat(g.versionNumber)<10?!0:!1,i=function(a,b){var c,d,e;b.timestamp=(new Date).getTime(),d=[];for(c in b)e=b[c],d.push(c+"="+e);return a+=-1===a.indexOf("?")?"?":"&",a+=d.join("&")},d=function(){function a(){}return a.get=function(a,b,c){return"function"==typeof b&&(c=b,b={}),a=i(a,b),h("xmlHttpRequest.get",{url:a,data:b}),m.get(a,c)},a.getWithJSONPFallback=function(a,b,c){var d;return(d=k?this.jsonp:this.get)(a,b,c)},a.post=function(a,b,c){return"function"==typeof b&&(c=b,b={}),h("xmlHttpRequest.post",{url:a,data:b}),m.post(a,b,c)},a.postWithJSONPFallback=function(a,b,c){var d;return(d=k?this.jsonp:this.post)(a,b,callback)},a.jsonp=function(a,b,c){return"function"==typeof b&&(c=b,b={}),b.callback||(b.callback=f.genRandomStr()),a=i(a,b),h("jsonp",{url:a,data:b}),j.get(a,c)},a}(),e=function(){function a(){}return a.get=function(a,b,c){return l.get(a).query(b).end(function(a,b){return c(a,null!=b?b.body:void 0)})},a.getWithJSONPFallback=a.get,a.post=function(a,b,c){return l.post(a).send(b).end(function(a,b){return c(a,null!=b?b.body:void 0)})},a.postWithJSONPFallback=a.post,a}(),b.exports="undefined"!=typeof window&&null!==window?d:e},{"../index":31,"./jsonpRequest":34,"./xmlHttpRequest":36,debug:38,superagent:72}],34:[function(a,b,c){"use strict";var d,e;e=a("./loadJS.coffee"),d=function(a){var b,c;if(b=/[\?|&]callback=([a-z0-9_]+)/i,c=a.match(b),!c)throw new Error("Could not find callback on URL");return c[1]},b.exports.get=function(a,b){var c,f,g,h,i;try{c=d(a)}catch(h){return g=h,b(g)}return f=void 0,i=window[c],window[c]=function(a){return f=a},e.load(a).then(function(){return b(null,f)})["catch"](function(a){var d;if(a||f||(a=new Error("JSONP requeset can not get a JSON response")),i)window[c]=i;else try{delete window[c]}catch(d){a=d,window[c]=void 0}return b(a,f)})}},{"./loadJS.coffee":35}],35:[function(a,b,c){"use strict";var d,e,f,g;e=a("../promise"),f=a("debug")("engine:loadJS"),d=function(){function a(){this.loaded={}}return a.prototype.load=function(){var a,b,c,d,f;if(0===arguments.length)return e.reject("arguments error");for(f=[],c=0,d=arguments.length;d>c;c++)b=arguments[c],b instanceof Array?f=function(){var c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(this._load(a));return e}.call(this):f.push(this._load(b));return e.all(f)},a.prototype._load=function(a){var b,c;return c=this,b=new e(function(b,d){var e,g,h,i;return"loaded"===c.loaded[a]?b("loaded"):"loading"===c.loaded[a]?void(i=setInterval(function(){return"loaded"===c.loaded[a]?(null!=i&&clearInterval(i),b("loaded")):void 0},2e3)):(c.loaded[a]="loading",e=document.getElementsByTagName("head")[0],g=document.createElement("script"),g.type="text/javascript",g.src=a,g.async=!0,h=setTimeout(function(){return d("")},1e4),g.onreadystatechange=g.onload=function(d){return c.loaded[a]="loaded",null!=h&&clearTimeout(h),b(a)},g.onerror=function(b){return c.loaded[a]="error",f("loadJS error",a,b),null!=h&&clearTimeout(h),d(new Error(b))},e.appendChild(g))})},a.prototype.getExtensionJS=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(l={enableCache:["indexeddbshim.min.js","db.min.js"],enableMediaMessage:["plupload.min.js","qiniu.min.js","RecordRTC.js"]},c=[],"[object Array]"===Object.prototype.toString.call(a)){for(d=0,h=a.length;h>d;d++)if(b=a[d],l[b])for(m=l[b],e=0,i=m.length;i>e;e++)k=m[e],c.push(k)}else for(f in a)if(o=a[f],"function"!=typeof o&&o)for(n=l[f],g=0,j=n.length;j>g;g++)k=n[g],c.push(k);return c},a.prototype.getExtensionJSPaths=function(a,b){var c;return c=new RegExp("^[A-Za-z]+://[A-Za-z0-9-_]+\\.[A-Za-z0-9-_%&?/.=]+(js)$"),c.test(a)?a:(this.basePath=b||"/",null==this.basePath&&this.throwError("If you want to use the extension, You must specify the base path!"),b="/"===this.basePath.charAt(this.basePath.length-1)?this.basePath+"libs/":this.basePath+"/libs/",""+b+a)},a.prototype.requireExtensionJSPaths=function(a,b){var c,d,e,f,g;for(d=[],g=this.getExtensionJS([a]),e=0,f=g.length;f>e;e++)c=g[e],d.push(this.getExtensionJSPaths(c));return d},a.prototype.require=function(a,b){var c,d,e,f,g;for(d=[],g=this.getExtensionJS([a]),e=0,f=g.length;f>e;e++)c=g[e],d.push(this.getExtensionJSPaths(c,b));return this.load(d)},a}(),g=new d,b.exports=g},{"../promise":32,debug:38}],36:[function(a,b,c){"use strict";var d,e;d=function(){try{if(window.XMLHttpRequest)return new XMLHttpRequest}catch(a){}},e=function(a,b,c,e,f){var g,h,i,j,k;null==c&&(c={}),k=d(),k.open(a,b,!0);for(i in c)j=c[i],k.setRequestHeader(i,j);k.onload=function(){var a,b,c;if(4===k.readyState){if(200!==k.status)return f(new Error("Unexpected response, status: "+k.status));try{c=JSON.parse(k.responseText)}catch(b){return a=b,f(a)}return f(null,c)}},k.onerror=function(){return f(new Error("Unexpected response, status: "+k.status))};try{return k.send(e)}catch(h){return g=h,f(g)}},c.get=function(a,b){return e("GET",a,null,null,b)},c.post=function(a,b,c){var d;return d={"Content-Type":"application/json"},b=JSON.stringify(b),e("POST",a,d,b,c)}},{}],37:[function(a,b,c){(function(a){"use strict";var c,d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c=function(){function b(){}return b.version="v1",b.eventNameMaxLength=128,b.eventDataMaxSize=10240,b.channelNamePattern=new RegExp("^[a-zA-Z0-9_\\-=@,.;]+$"),b.channelNameFullPattern=new RegExp("^[a-zA-Z0-9_\\-=@,.;]{1,128}$"),b.privateChannelNameFullPattern=new RegExp("^private-[a-zA-Z0-9_\\-=@,.;]{0,120}$"),b.presenceChannelNameFullPattern=new RegExp("^presence-[a-zA-Z0-9_\\-=@,.;]{0,119}$"),b.channelNameMaxLength=128,b.presenceChannelUserMaxCount=1e3,b.presenceChannelUserIdMaxLength=128,b.presenceChannelUserInfoMaxSize=1024,b.internalEventNamePattern=new RegExp("^engine_.*"),b.connectionEventNamePattern=new RegExp("^engine_connection"),b.channelEventNamePattern=new RegExp("^engine_channel"),b.chatEventNamePattern=new RegExp("^engine_chat"),b.responseEventNamePattern=new RegExp("^engine_response$"),b.connErrors={requestInvalid:{code:4e3,message:"Request is invalid."},requestProtocolNotSupported:{code:4001,message:"Request protocol is not supported."},eventInvalid:{code:4010,message:"Event is invalid."},eventNameTooLong:{code:4011,message:"Event name is too long."},eventDataTooBig:{code:4012,message:"Event data is too big."},appNotExists:{code:4020,message:"App does not exist."},appDisabled:{code:4021,message:"App is disabled."},serverInternalError:{code:4100,message:"Server internal error, please try again later.",reconnectStrategy:"static",reconnectIn:6e4},serverMaintenance:{code:4101,message:"Server is under maintenance, please try again later.",reconnectStrategy:"backoff",reconnectIn:3e4,reconnectInMax:3e5},serverOverCapacity:{code:4102,message:"Server is over capacity, please try again later.",reconnectStrategy:"backoff",reconnectIn:1e4,reconnectInMax:3e5},appOverConnectionQuota:{code:4110,message:"App is over connection quota, please try again later.",reconnectStrategy:"static",reconnectIn:6e5}},b.responseErrors={noConnection:{code:4500,message:"Connection is not available, please check your network configuration."},serverInternalError:{code:4501,message:"Server internal error, please try again later."},incorrectSignature:{code:4502,message:"Incorrect signature."},unauthorized:{code:4503,message:"Unauthorized, please login first."},invalidRequest:{code:4504,message:"Invalid request."},permissionDenied:{code:4505,message:"Permission denied."},fileOperationFailed:{code:4506,message:"File operation failed."},requestTimeout:{code:4507,message:"Request timed out."}},b._throwError=function(a){throw a},b._validateEvent=function(b,c){var d;return b.id&&b.name||this._throwError(this.connErrors.eventInvalid),b.name.length>this.eventNameMaxLength&&this._throwError(this.connErrors.eventNameTooLong),c?(d=a.byteLength(JSON.stringify(b.data),"utf8"),d>this.eventDataMaxSize?this._throwError(this.connErrors.eventDataTooBig):void 0):void 0},b.decodeEvent=function(a){var b,c;try{a=JSON.parse(a)}catch(c){b=c,this._throwError(this.connErrors.eventInvalid)}return this._validateEvent(a),a},b.encodeEvent=function(a,b){return null==b&&(b=!0),this._validateEvent(a,b),JSON.stringify(a)},b.validateChannel=function(a){var b;return a||this._throwError(new Error("Channel name is required.")),this.channelNamePattern.test(a)||this._throwError(new Error("Channel name contains invalid character.")),a.length>this.channelNameMaxLength&&this._throwError(new Error("Channel name is too long.")),b="channel",this.privateChannelNameFullPattern.test(a)?b="privateChannel":this.presenceChannelNameFullPattern.test(a)&&(b="presenceChannel"),b},b.validatePresenceChannelUser=function(b,c){var e,f,g;return f=_.unique(b),f.length>=this.presenceChannelUserMaxCount&&(e=c.userId,d.call(f,e)<0)&&this._throwError(new Error("Exceeds max presence channel user count.")),g=a.byteLength(JSON.stringify(c.userInfo),"utf8"),g>this.presenceChannelUserInfoMaxSize?this._throwError(new Error("Exceeds max user info size.")):void 0},b}(),b.exports=c}).call(this,a("buffer").Buffer)},{buffer:73}],38:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?"%c ":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),b){var d="color: "+this.color;a=[a[0],d,""].concat(Array.prototype.slice.call(a,1));var e=0,f=0;a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d)}return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,a)}function f(a){try{null==a?localStorage.removeItem("debug"):localStorage.debug=a}catch(b){}}function g(){var a;try{a=localStorage.debug}catch(b){}return a}c=b.exports=a("./debug"),c.log=e,c.save=f,c.load=g,c.useColors=d,c.colors=["cyan","green","goldenrod","blue","purple","red"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(g())},{"./debug":39}],39:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),c.log.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace("*",".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:40}],40:[function(a,b,c){function d(a){var b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"h":return c*j;case"minutes":case"minute":case"m":return c*i;case"seconds":case"second":case"s":return c*h;case"ms":return c}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],41:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":42}],42:[function(a,b,c){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":43,"engine.io-parser":56}],43:[function(a,b,c){(function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);if(b=b||{},a&&"object"==typeof a&&(b=a,a=null),a&&(a=k(a),b.host=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)),this.secure=null!=b.secure?b.secure:c.location&&"https:"==location.protocol,b.host){var e=b.host.split(":");b.hostname=e.shift(),e.length?b.port=e.pop():b.port||(b.port=this.secure?"443":"80")}this.agent=b.agent||!1,this.hostname=b.hostname||(c.location?location.hostname:"localhost"),this.port=b.port||(c.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=m.decode(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.jsonp=!1!==b.jsonp,this.forceBase64=!!b.forceBase64,this.enablesXDR=!!b.enablesXDR,this.timestampParam=b.timestampParam||"t",this.timestampRequests=b.timestampRequests,this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=b.policyPort||843,this.rememberUpgrade=b.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=b.onlyBinaryUpgrades,this.pfx=b.pfx||null,this.key=b.key||null,this.passphrase=b.passphrase||null,this.cert=b.cert||null,this.ca=b.ca||null,this.ciphers=b.ciphers||null,this.rejectUnauthorized=b.rejectUnauthorized||null,this.open()}function e(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var f=a("./transports"),g=a("component-emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser"),k=a("parseuri"),l=a("parsejson"),m=a("parseqs");b.exports=d,d.priorWebsocketSuccess=!1,g(d.prototype),d.protocol=j.protocol,d.Socket=d,d.Transport=a("./transport"),d.transports=a("./transports"),d.parser=a("engine.io-parser"),d.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=e(this.query);b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id);var c=new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return c},d.prototype.open=function(){var a;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))a="websocket";else{if(0==this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";var a;try{a=this.createTransport(a)}catch(c){return this.transports.shift(),void this.open()}a.open(),this.setTransport(a)},d.prototype.setTransport=function(a){h("setting transport %s",a.name);var b=this;this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},d.prototype.probe=function(a){function b(){if(m.onlyBinaryUpgrades){var b=!this.supportsBinary&&m.transport.supportsBinary;l=l||b}l||(h('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!l)if("pong"==b.type&&"probe"==b.data){if(h('probe transport "%s" pong',a),m.upgrading=!0,m.emit("upgrading",k),!k)return;d.priorWebsocketSuccess="websocket"==k.name,h('pausing current transport "%s"',m.transport.name),m.transport.pause(function(){l||"closed"!=m.readyState&&(h("changing transport and sending upgrade packet"),j(),m.setTransport(k),k.send([{type:"upgrade"}]),m.emit("upgrade",k),k=null,m.upgrading=!1,m.flush())})}else{h('probe transport "%s" failed',a);var c=new Error("probe error");c.transport=k.name,m.emit("upgradeError",c)}}))}function c(){l||(l=!0,j(),k.close(),k=null)}function e(b){var d=new Error("probe error: "+b);d.transport=k.name,c(),h('probe transport "%s" failed because of error: %s',a,b),m.emit("upgradeError",d)}function f(){e("transport closed")}function g(){e("socket closed")}function i(a){k&&a.name!=k.name&&(h('"%s" works - aborting "%s"',a.name,k.name),c())}function j(){k.removeListener("open",b),k.removeListener("error",e),k.removeListener("close",f),m.removeListener("close",g),m.removeListener("upgrading",i)}h('probing transport "%s"',a);var k=this.createTransport(a,{probe:1}),l=!1,m=this;d.priorWebsocketSuccess=!1,k.once("open",b),k.once("error",e),k.once("close",f),this.once("close",g),this.once("upgrading",i),k.open()},d.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},d.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(l(a.data));break;case"pong":this.setPing();break;case"error":var b=new Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else h('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},d.prototype.ping=function(){this.sendPacket("ping")},d.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},d.prototype.sendPacket=function(a,b,c){if("closing"!=this.readyState&&"closed"!=this.readyState){var d={type:a,data:b};this.emit("packetCreate",d),this.writeBuffer.push(d),this.callbackBuffer.push(c),this.flush()}},d.prototype.close=function(){function a(){d.onClose("forced close"),h("socket closing - telling transport to close"),d.transport.close()}function b(){d.removeListener("upgrade",b),d.removeListener("upgradeError",b),a()}function c(){d.once("upgrade",b),d.once("upgradeError",b)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this},d.prototype.onError=function(a){h("socket error %j",a),d.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},d.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b)}},d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;d>c;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":44,"./transports":45,"component-emitter":51,debug:53,"engine.io-parser":56,indexof:67,parsejson:68,parseqs:69,parseuri:70}],44:[function(a,b,c){function d(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized}var e=a("engine.io-parser"),f=a("component-emitter");b.exports=d,f(d.prototype),d.timestamps=0,d.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},d.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},d.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},d.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},d.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},d.prototype.onData=function(a){var b=e.decodePacket(a,this.socket.binaryType);this.onPacket(b)},d.prototype.onPacket=function(a){this.emit("packet",a)},d.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":51,"engine.io-parser":56}],45:[function(a,b,c){(function(b){function d(a){var c,d=!1,h=!1,i=!1!==a.jsonp;if(b.location){var j="https:"==location.protocol,k=location.port;k||(k=j?443:80),d=a.hostname!=location.hostname||k!=a.port,h=a.secure!=j}if(a.xdomain=d,a.xscheme=h,c=new e(a),"open"in c&&!a.forceJSONP)return new f(a);if(!i)throw new Error("JSONP disabled");return new g(a)}var e=a("xmlhttprequest"),f=a("./polling-xhr"),g=a("./polling-jsonp"),h=a("./websocket");c.polling=d,c.websocket=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":46,"./polling-xhr":47,"./websocket":49,xmlhttprequest:50}],46:[function(a,b,c){(function(c){function d(){}function e(a){f.call(this,a),this.query=this.query||{},h||(c.___eio||(c.___eio=[]),h=c.___eio),this.index=h.length;var b=this;h.push(function(a){b.onData(a)}),this.query.j=this.index,c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=d)},!1)}var f=a("./polling"),g=a("component-inherit");b.exports=e;var h,i=/\n/g,j=/\\n/g;g(e,f),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),f.prototype.doClose.call(this)},e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.script=b;var d="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);d&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},e.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var b='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(b)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),h=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=k,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.uri(),d(),a=a.replace(j,"\\\n"),this.area.value=a.replace(i,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":48,"component-inherit":52}],47:[function(a,b,c){(function(c){function d(){}function e(a){if(i.call(this,a),c.location){var b="https:"==location.protocol,d=location.port;d||(d=b?443:80),this.xd=a.hostname!=c.location.hostname||d!=a.port,this.xs=a.secure!=b}}function f(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.xs=!!a.xs,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.isBinary=a.isBinary,this.supportsBinary=a.supportsBinary,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.create()}function g(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var h=a("xmlhttprequest"),i=a("./polling"),j=a("component-emitter"),k=a("component-inherit"),l=a("debug")("engine.io-client:polling-xhr");b.exports=e,b.exports.Request=f,k(e,i),e.prototype.supportsBinary=!0,e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,
a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,new f(a)},e.prototype.doWrite=function(a,b){var c="string"!=typeof a&&void 0!==a,d=this.request({method:"POST",data:a,isBinary:c}),e=this;d.on("success",b),d.on("error",function(a){e.onError("xhr post error",a)}),this.sendXhr=d},e.prototype.doPoll=function(){l("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},j(f.prototype),f.prototype.create=function(){var a={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new h(a),d=this;try{if(l("xhr open %s: %s",this.method,this.uri),b.open(this.method,this.uri,this.async),this.supportsBinary&&(b.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in b&&(b.withCredentials=!0),this.hasXDR()?(b.onload=function(){d.onLoad()},b.onerror=function(){d.onError(b.responseText)}):b.onreadystatechange=function(){4==b.readyState&&(200==b.status||1223==b.status?d.onLoad():setTimeout(function(){d.onError(b.status)},0))},l("xhr data %s",this.data),b.send(this.data)}catch(e){return void setTimeout(function(){d.onError(e)},0)}c.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},f.prototype.onError=function(a){this.emit("error",a),this.cleanup(!0)},f.prototype.cleanup=function(a){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,a)try{this.xhr.abort()}catch(b){}c.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var a;try{var b;try{b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(c){}a="application/octet-stream"===b?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(c){this.onError(c)}null!=a&&this.onData(a)},f.prototype.hasXDR=function(){return"undefined"!=typeof c.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},c.document&&(f.requestsCount=0,f.requests={},c.attachEvent?c.attachEvent("onunload",g):c.addEventListener&&c.addEventListener("beforeunload",g,!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":48,"component-emitter":51,"component-inherit":52,debug:53,xmlhttprequest:50}],48:[function(a,b,c){function d(a){var b=a&&a.forceBase64;(!j||b)&&(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("parseqs"),g=a("engine.io-parser"),h=a("component-inherit"),i=a("debug")("engine.io-client:polling");b.exports=d;var j=function(){var b=a("xmlhttprequest"),c=new b({xdomain:!1});return null!=c.responseType}();h(d,e),d.prototype.name="polling",d.prototype.doOpen=function(){this.poll()},d.prototype.pause=function(a){function b(){i("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(i("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){i("pre-pause polling complete"),--d||b()})),this.writable||(i("we are currently writing - waiting to pause"),d++,this.once("drain",function(){i("pre-pause writing complete"),--d||b()}))}else b()},d.prototype.poll=function(){i("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},d.prototype.onData=function(a){var b=this;i("polling got data %s",a);var c=function(a,c,d){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)};g.decodePayload(a,this.socket.binaryType,c),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():i('ignoring poll - transport state "%s"',this.readyState))},d.prototype.doClose=function(){function a(){i("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(i("transport open - closing"),a()):(i("transport not open - deferring close"),this.once("open",a))},d.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;g.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";return!1!==this.timestampRequests&&(a[this.timestampParam]=+new Date+"-"+e.timestamps++),this.supportsBinary||a.sid||(a.b64=1),a=f.encode(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a}},{"../transport":44,"component-inherit":52,debug:53,"engine.io-parser":56,parseqs:69,xmlhttprequest:50}],49:[function(a,b,c){function d(a){var b=a&&a.forceBase64;b&&(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("engine.io-parser"),g=a("parseqs"),h=a("component-inherit"),i=a("debug")("engine.io-client:websocket"),j=a("ws");b.exports=d,h(d,e),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=void 0,c={agent:this.agent};c.pfx=this.pfx,c.key=this.key,c.passphrase=this.passphrase,c.cert=this.cert,c.ca=this.ca,c.ciphers=this.ciphers,c.rejectUnauthorized=this.rejectUnauthorized,this.ws=new j(a,b,c),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(a){var b=this;setTimeout(function(){e.prototype.onData.call(b,a)},0)}),d.prototype.write=function(a){function b(){c.writable=!0,c.emit("drain")}var c=this;this.writable=!1;for(var d=0,e=a.length;e>d;d++)f.encodePacket(a[d],this.supportsBinary,function(a){try{c.ws.send(a)}catch(b){i("websocket closed before onclose event")}});setTimeout(b,0)},d.prototype.onClose=function(){e.prototype.onClose.call(this)},d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),this.supportsBinary||(a.b64=1),a=g.encode(a),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a},d.prototype.check=function(){return!(!j||"__initialize"in j&&this.name===d.prototype.name)}},{"../transport":44,"component-inherit":52,debug:53,"engine.io-parser":56,parseqs:69,ws:71}],50:[function(a,b,c){var d=a("has-cors");b.exports=function(a){var b=a.xdomain,c=a.xscheme,e=a.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||d))return new XMLHttpRequest}catch(f){}try{if("undefined"!=typeof XDomainRequest&&!c&&e)return new XDomainRequest}catch(f){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}},{"has-cors":65}],51:[function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],52:[function(a,b,c){b.exports=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],53:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?localStorage.removeItem("debug"):localStorage.debug=a}catch(b){}}function h(){var a;try{a=localStorage.debug}catch(b){}return a}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":54}],54:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:55}],55:[function(a,b,c){b.exports=a(40)},{"/root/wp/server/node_modules/debug/node_modules/ms/index.js":40}],56:[function(a,b,c){(function(b){function d(a,b){var d="b"+c.packets[a.type]+a.data.data;return b(d)}function e(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=a.data,f=new Uint8Array(e),g=new Uint8Array(1+e.byteLength);g[0]=r[a.type];for(var h=0;h<f.length;h++)g[h+1]=f[h];return d(g.buffer)}function f(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=new FileReader;return e.onload=function(){a.data=e.result,c.encodePacket(a,b,!0,d)},e.readAsArrayBuffer(a.data)}function g(a,b,d){if(!b)return c.encodeBase64Packet(a,d);if(q)return f(a,b,d);var e=new Uint8Array(1);e[0]=r[a.type];var g=new u([e.buffer,a.data]);return d(g)}function h(a,b,c){for(var d=new Array(a.length),e=m(a.length,c),f=function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})},g=0;g<a.length;g++)f(g,a[g],e)}var i=a("./keys"),j=a("has-binary"),k=a("arraybuffer.slice"),l=a("base64-arraybuffer"),m=a("after"),n=a("utf8"),o=navigator.userAgent.match(/Android/i),p=/PhantomJS/i.test(navigator.userAgent),q=o||p;c.protocol=3;var r=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=i(r),t={type:"error",data:"parser error"},u=a("blob");c.encodePacket=function(a,c,f,h){"function"==typeof c&&(h=c,c=!1),"function"==typeof f&&(h=f,f=null);var i=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&i instanceof ArrayBuffer)return e(a,c,h);if(u&&i instanceof b.Blob)return g(a,c,h);if(i&&i.base64)return d(a,h);var j=r[a.type];return void 0!==a.data&&(j+=f?n.encode(String(a.data)):String(a.data)),h(""+j)},c.encodeBase64Packet=function(a,d){var e="b"+c.packets[a.type];if(u&&a.data instanceof u){var f=new FileReader;return f.onload=function(){var a=f.result.split(",")[1];d(e+a)},f.readAsDataURL(a.data)}var g;try{g=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(h){for(var i=new Uint8Array(a.data),j=new Array(i.length),k=0;k<i.length;k++)j[k]=i[k];g=String.fromCharCode.apply(null,j)}return e+=b.btoa(g),d(e)},c.decodePacket=function(a,b,d){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return c.decodeBase64Packet(a.substr(1),b);if(d)try{a=n.decode(a)}catch(e){return t}var f=a.charAt(0);return Number(f)==f&&s[f]?a.length>1?{type:s[f],data:a.substring(1)}:{type:s[f]}:t}var g=new Uint8Array(a),f=g[0],h=k(a,1);return u&&"blob"===b&&(h=new u([h])),{type:s[f],data:h}},c.decodeBase64Packet=function(a,c){var d=s[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var e=l.decode(a.substr(1));return"blob"===c&&u&&(e=new u([e])),{type:d,data:e}},c.encodePayload=function(a,b,d){function e(a){return a.length+":"+a}function f(a,d){c.encodePacket(a,g?b:!1,!0,function(a){d(null,e(a))})}"function"==typeof b&&(d=b,b=null);var g=j(a);return b&&g?u&&!q?c.encodePayloadAsBlob(a,d):c.encodePayloadAsArrayBuffer(a,d):a.length?void h(a,f,function(a,b){return d(b.join(""))}):d("0:")},c.decodePayload=function(a,b,d){if("string"!=typeof a)return c.decodePayloadAsBinary(a,b,d);"function"==typeof b&&(d=b,b=null);var e;if(""==a)return d(t,0,1);for(var f,g,h="",i=0,j=a.length;j>i;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(f=Number(h)))return d(t,0,1);if(g=a.substr(i+1,f),h!=g.length)return d(t,0,1);if(g.length){if(e=c.decodePacket(g,b,!0),t.type==e.type&&t.data==e.data)return d(t,0,1);var l=d(e,i+f,j);if(!1===l)return}i+=f,h=""}}return""!=h?d(t,0,1):void 0},c.encodePayloadAsArrayBuffer=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){return b(null,a)})}return a.length?void h(a,d,function(a,c){var d=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var d=new Uint8Array(a.length),g=0;g<a.length;g++)d[g]=a.charCodeAt(g);c=d.buffer}b?e[f++]=0:e[f++]=1;for(var h=c.byteLength.toString(),g=0;g<h.length;g++)e[f++]=parseInt(h[g]);e[f++]=255;for(var d=new Uint8Array(c),g=0;g<d.length;g++)e[f++]=d[g]}),b(e.buffer)}):b(new ArrayBuffer(0))},c.encodePayloadAsBlob=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var f=a instanceof ArrayBuffer?a.byteLength:a.size,g=f.toString(),h=new Uint8Array(g.length+1),e=0;e<g.length;e++)h[e]=parseInt(g[e]);if(h[g.length]=255,u){var i=new u([c.buffer,h.buffer,a]);b(null,i)}})}h(a,d,function(a,c){return b(new u(c))})},c.decodePayloadAsBinary=function(a,b,d){"function"==typeof b&&(d=b,b=null);for(var e=a,f=[],g=!1;e.byteLength>0;){for(var h=new Uint8Array(e),i=0===h[0],j="",l=1;255!=h[l];l++){if(j.length>310){g=!0;break}j+=h[l]}if(g)return d(t,0,1);e=k(e,2+j.length),j=parseInt(j);var m=k(e,0,j);if(i)try{m=String.fromCharCode.apply(null,new Uint8Array(m))}catch(n){var o=new Uint8Array(m);m="";for(var l=0;l<o.length;l++)m+=String.fromCharCode(o[l])}f.push(m),e=k(e,j)}var p=f.length;f.forEach(function(a,e){d(c.decodePacket(a,b,!0),e,p)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":57,after:58,"arraybuffer.slice":59,"base64-arraybuffer":60,blob:61,"has-binary":62,utf8:64}],57:[function(a,b,c){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],58:[function(a,b,c){function d(a,b,c){function d(a,e){if(d.count<=0)throw new Error("after called too many times");--d.count,a?(f=!0,b(a),b=c):0!==d.count||f||b(null,e)}var f=!1;return c=c||e,d.count=a,0===a?b():d}function e(){}b.exports=d},{}],59:[function(a,b,c){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,a.slice)return a.slice(b,c);if(0>b&&(b+=d),0>c&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);for(var e=new Uint8Array(a),f=new Uint8Array(c-b),g=b,h=0;c>g;g++,h++)f[h]=e[g];return f.buffer}},{}],60:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;e>c;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;i>c;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],61:[function(a,b,c){(function(a){function c(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength)),d=e.buffer}a[b]=d}}}function d(a,b){b=b||{};var d=new f;c(a);for(var e=0;e<a.length;e++)d.append(a[e]);return b.type?d.getBlob(b.type):d.getBlob()}function e(a,b){return c(a),new Blob(a,b||{})}var f=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder,g=function(){try{var a=new Blob(["hi"]);return 2===a.size}catch(b){return!1}}(),h=g&&function(){try{var a=new Blob([new Uint8Array([1,2])]);return 2===a.size}catch(b){return!1}}(),i=f&&f.prototype.append&&f.prototype.getBlob;b.exports=function(){return g?h?a.Blob:e:i?d:void 0}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],62:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:63}],63:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],64:[function(a,b,c){(function(a){!function(d){function e(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a){for(var b,c=a.length,d=-1,e="";++d<c;)b=a[d],b>65535&&(b-=65536,e+=t(b>>>10&1023|55296),b=56320|1023&b),e+=t(b);return e}function g(a){if(a>=55296&&57343>=a)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value")}function h(a,b){return t(a>>b&63|128)}function i(a){if(0==(4294967168&a))return t(a);var b="";return 0==(4294965248&a)?b=t(a>>6&31|192):0==(4294901760&a)?(g(a),b=t(a>>12&15|224),b+=h(a,6)):0==(4292870144&a)&&(b=t(a>>18&7|240),b+=h(a,12),b+=h(a,6)),b+=t(63&a|128)}function j(a){for(var b,c=e(a),d=c.length,f=-1,g="";++f<d;)b=c[f],g+=i(b);return g}function k(){if(s>=r)throw Error("Invalid byte index");var a=255&q[s];if(s++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function l(){var a,b,c,d,e;if(s>r)throw Error("Invalid byte index");if(s==r)return!1;if(a=255&q[s],s++,0==(128&a))return a;if(192==(224&a)){var b=k();if(e=(31&a)<<6|b,e>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=k(),c=k(),e=(15&a)<<12|b<<6|c,e>=2048)return g(e),e;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=k(),c=k(),d=k(),e=(15&a)<<18|b<<12|c<<6|d,e>=65536&&1114111>=e))return e;throw Error("Invalid UTF-8 detected")}function m(a){q=e(a),r=q.length,s=0;for(var b,c=[];(b=l())!==!1;)c.push(b);return f(c)}var n="object"==typeof c&&c,o="object"==typeof b&&b&&b.exports==n&&b,p="object"==typeof a&&a;(p.global===p||p.window===p)&&(d=p);var q,r,s,t=String.fromCharCode,u={version:"2.0.0",encode:j,decode:m};if(n&&!n.nodeType)if(o)o.exports=u;else{var v={},w=v.hasOwnProperty;for(var x in u)w.call(u,x)&&(n[x]=u[x])}else"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return u}):d.utf8=u}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],65:[function(a,b,c){var d=a("global");try{b.exports="XMLHttpRequest"in d&&"withCredentials"in new d.XMLHttpRequest}catch(e){b.exports=!1}},{global:66}],66:[function(a,b,c){b.exports=function(){return this}()},{}],67:[function(a,b,c){var d=[].indexOf;b.exports=function(a,b){if(d)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},{}],68:[function(a,b,c){(function(a){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,f=/(?:^|:|,)(?:\s*\[)+/g,g=/^\s+/,h=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(g,"").replace(h,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(d,"@").replace(e,"]").replace(f,""))?new Function("return "+b)():void 0):null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],69:[function(a,b,c){c.encode=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.decode=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],70:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){var b=a,c=a.indexOf("["),f=a.indexOf("]");-1!=c&&-1!=f&&(a=a.substring(0,c)+a.substring(c,f).replace(/:/g,";")+a.substring(f,a.length));for(var g=d.exec(a||""),h={},i=14;i--;)h[e[i]]=g[i]||"";return-1!=c&&-1!=f&&(h.source=b,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h}},{}],71:[function(a,b,c){function d(a,b,c){var d;return d=b?new f(a,b):new f(a)}var e=function(){return this}(),f=e.WebSocket||e.MozWebSocket;b.exports=f?d:null,f&&(d.prototype=f.prototype)},{}],72:[function(a,b,c){},{}],73:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e,f=typeof a;if("number"===f)e=a>0?a>>>0:0;else if("string"===f)"base64"===b&&(a=x(a)),e=d.byteLength(a,b);else{if("object"!==f||null===a)throw new TypeError("must start with number, buffer, array or string");"Buffer"===a.type&&J(a.data)&&(a=a.data),e=+a.length>0?Math.floor(+a.length):0}if(this.length>K)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K.toString(16)+" bytes");var g;d.TYPED_ARRAY_SUPPORT?g=d._augment(new Uint8Array(e)):(g=this,g.length=e,g._isBuffer=!0);var h;if(d.TYPED_ARRAY_SUPPORT&&"number"==typeof a.byteLength)g._set(a);else if(z(a))if(d.isBuffer(a))for(h=0;e>h;h++)g[h]=a.readUInt8(h);else for(h=0;e>h;h++)g[h]=(a[h]%256+256)%256;else if("string"===f)g.write(a,0,b);else if("number"===f&&!d.TYPED_ARRAY_SUPPORT&&!c)for(h=0;e>h;h++)g[h]=0;return g}function e(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function f(a,b,c,d){var e=F(B(b),a,c,d);return e}function g(a,b,c,d){var e=F(C(b),a,c,d);return e}function h(a,b,c,d){return g(a,b,c,d)}function i(a,b,c,d){var e=F(E(b),a,c,d);return e}function j(a,b,c,d){var e=F(D(b),a,c,d,2);return e}function k(a,b,c){return 0===b&&c===a.length?H.fromByteArray(a):H.fromByteArray(a.slice(b,c))}function l(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=G(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+G(e)}function m(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function n(a,b,c){return m(a,b,c)}function o(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=A(a[f]);return e}function p(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function q(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function r(a,b,c,e,f,g){if(!d.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>f||g>b)throw new TypeError("value is out of bounds");if(c+e>a.length)throw new TypeError("index out of range")}function s(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function t(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function u(a,b,c,d,e,f){if(b>e||f>b)throw new TypeError("value is out of bounds");if(c+d>a.length)throw new TypeError("index out of range")}function v(a,b,c,d,e){return e||u(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),I.write(a,b,c,d,23,4),c+4}function w(a,b,c,d,e){return e||u(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),I.write(a,b,c,d,52,8),c+8}function x(a){for(a=y(a).replace(M,"");a.length%4!==0;)a+="=";return a}function y(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function z(a){return J(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function A(a){return 16>a?"0"+a.toString(16):a.toString(16)}function B(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);if(127>=d)b.push(d);else{var e=c;d>=55296&&57343>=d&&c++;for(var f=encodeURIComponent(a.slice(e,c+1)).substr(1).split("%"),g=0;g<f.length;g++)b.push(parseInt(f[g],16))}}return b}function C(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function D(a){for(var b,c,d,e=[],f=0;f<a.length;f++)b=a.charCodeAt(f),c=b>>8,d=b%256,e.push(d),e.push(c);return e}function E(a){return H.toByteArray(a)}function F(a,b,c,d,e){e&&(d-=d%e);for(var f=0;d>f&&!(f+c>=b.length||f>=a.length);f++)b[f+c]=a[f];return f}function G(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}var H=a("base64-js"),I=a("ieee754"),J=a("is-array");c.Buffer=d,c.SlowBuffer=d,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var K=1073741823;d.TYPED_ARRAY_SUPPORT=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);return b.foo=function(){return 42},42===b.foo()&&"function"==typeof b.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(c){return!1}}(),d.isBuffer=function(a){return!(null==a||!a._isBuffer)},d.compare=function(a,b){if(!d.isBuffer(a)||!d.isBuffer(b))throw new TypeError("Arguments must be Buffers");for(var c=a.length,e=b.length,f=0,g=Math.min(c,e);g>f&&a[f]===b[f];f++);return f!==g&&(c=a[f],e=b[f]),e>c?-1:c>e?1:0},d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(a,b){if(!J(a))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===a.length)return new d(0);if(1===a.length)return a[0];var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.byteLength=function(a,b){var c;switch(a+="",b||"utf8"){case"ascii":case"binary":case"raw":c=a.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=2*a.length;break;case"hex":c=a.length>>>1;break;case"utf8":case"utf-8":c=B(a).length;break;case"base64":c=E(a).length;break;default:c=a.length}return c},d.prototype.length=void 0,d.prototype.parent=void 0,d.prototype.toString=function(a,b,c){var d=!1;if(b>>>=0,c=void 0===c||c===1/0?this.length:c>>>0,a||(a="utf8"),0>b&&(b=0),c>this.length&&(c=this.length),b>=c)return"";for(;;)switch(a){case"hex":return o(this,b,c);case"utf8":case"utf-8":return l(this,b,c);case"ascii":return m(this,b,c);case"binary":return n(this,b,c);case"base64":return k(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}},d.prototype.equals=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return 0===d.compare(this,a)},d.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},d.prototype.compare=function(a){if(!d.isBuffer(a))throw new TypeError("Argument must be a Buffer");return d.compare(this,a)},d.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},d.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var k=d;d=b,b=c,c=k}b=Number(b)||0;var l=this.length-b;c?(c=Number(c),c>l&&(c=l)):c=l,d=String(d||"utf8").toLowerCase();var m;switch(d){case"hex":m=e(this,a,b,c);break;case"utf8":case"utf-8":m=f(this,a,b,c);break;case"ascii":m=g(this,a,b,c);break;case"binary":m=h(this,a,b,c);break;case"base64":m=i(this,a,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=j(this,a,b,c);break;default:throw new TypeError("Unknown encoding: "+d)}return m},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(a,b){var c=this.length;if(a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a),d.TYPED_ARRAY_SUPPORT)return d._augment(this.subarray(a,b));for(var e=b-a,f=new d(e,void 0,!0),g=0;e>g;g++)f[g]=this[g+a];return f},d.prototype.readUInt8=function(a,b){return b||q(a,1,this.length),this[a]},d.prototype.readUInt16LE=function(a,b){return b||q(a,2,this.length),this[a]|this[a+1]<<8},d.prototype.readUInt16BE=function(a,b){return b||q(a,2,this.length),this[a]<<8|this[a+1]},d.prototype.readUInt32LE=function(a,b){return b||q(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3];
},d.prototype.readUInt32BE=function(a,b){return b||q(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},d.prototype.readInt8=function(a,b){return b||q(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},d.prototype.readInt16LE=function(a,b){b||q(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt16BE=function(a,b){b||q(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},d.prototype.readInt32LE=function(a,b){return b||q(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},d.prototype.readInt32BE=function(a,b){return b||q(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},d.prototype.readFloatLE=function(a,b){return b||q(a,4,this.length),I.read(this,a,!0,23,4)},d.prototype.readFloatBE=function(a,b){return b||q(a,4,this.length),I.read(this,a,!1,23,4)},d.prototype.readDoubleLE=function(a,b){return b||q(a,8,this.length),I.read(this,a,!0,52,8)},d.prototype.readDoubleBE=function(a,b){return b||q(a,8,this.length),I.read(this,a,!1,52,8)},d.prototype.writeUInt8=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,1,255,0),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=a,b+1},d.prototype.writeUInt16LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):s(this,a,b,!0),b+2},d.prototype.writeUInt16BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):s(this,a,b,!1),b+2},d.prototype.writeUInt32LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=a):t(this,a,b,!0),b+4},d.prototype.writeUInt32BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):t(this,a,b,!1),b+4},d.prototype.writeInt8=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,1,127,-128),d.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=a,b+1},d.prototype.writeInt16LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8):s(this,a,b,!0),b+2},d.prototype.writeInt16BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=a):s(this,a,b,!1),b+2},d.prototype.writeInt32LE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):t(this,a,b,!0),b+4},d.prototype.writeInt32BE=function(a,b,c){return a=+a,b>>>=0,c||r(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),d.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=a):t(this,a,b,!1),b+4},d.prototype.writeFloatLE=function(a,b,c){return v(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){return v(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){return w(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){return w(this,a,b,!1,c)},d.prototype.copy=function(a,b,c,e){var f=this;if(c||(c=0),e||0===e||(e=this.length),b||(b=0),e!==c&&0!==a.length&&0!==f.length){if(c>e)throw new TypeError("sourceEnd < sourceStart");if(0>b||b>=a.length)throw new TypeError("targetStart out of bounds");if(0>c||c>=f.length)throw new TypeError("sourceStart out of bounds");if(0>e||e>f.length)throw new TypeError("sourceEnd out of bounds");e>this.length&&(e=this.length),a.length-b<e-c&&(e=a.length-b+c);var g=e-c;if(1e3>g||!d.TYPED_ARRAY_SUPPORT)for(var h=0;g>h;h++)a[h+b]=this[h+c];else a._set(this.subarray(c,c+g),b)}},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),b>c)throw new TypeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new TypeError("start out of bounds");if(0>c||c>this.length)throw new TypeError("end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=B(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},d.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(d.TYPED_ARRAY_SUPPORT)return new d(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var L=d.prototype;d._augment=function(a){return a.constructor=d,a._isBuffer=!0,a._get=a.get,a._set=a.set,a.get=L.get,a.set=L.set,a.write=L.write,a.toString=L.toString,a.toLocaleString=L.toString,a.toJSON=L.toJSON,a.equals=L.equals,a.compare=L.compare,a.copy=L.copy,a.slice=L.slice,a.readUInt8=L.readUInt8,a.readUInt16LE=L.readUInt16LE,a.readUInt16BE=L.readUInt16BE,a.readUInt32LE=L.readUInt32LE,a.readUInt32BE=L.readUInt32BE,a.readInt8=L.readInt8,a.readInt16LE=L.readInt16LE,a.readInt16BE=L.readInt16BE,a.readInt32LE=L.readInt32LE,a.readInt32BE=L.readInt32BE,a.readFloatLE=L.readFloatLE,a.readFloatBE=L.readFloatBE,a.readDoubleLE=L.readDoubleLE,a.readDoubleBE=L.readDoubleBE,a.writeUInt8=L.writeUInt8,a.writeUInt16LE=L.writeUInt16LE,a.writeUInt16BE=L.writeUInt16BE,a.writeUInt32LE=L.writeUInt32LE,a.writeUInt32BE=L.writeUInt32BE,a.writeInt8=L.writeInt8,a.writeInt16LE=L.writeInt16LE,a.writeInt16BE=L.writeInt16BE,a.writeInt32LE=L.writeInt32LE,a.writeInt32BE=L.writeInt32BE,a.writeFloatLE=L.writeFloatLE,a.writeFloatBE=L.writeFloatBE,a.writeDoubleLE=L.writeDoubleLE,a.writeDoubleBE=L.writeDoubleBE,a.fill=L.fill,a.inspect=L.inspect,a.toArrayBuffer=L.toArrayBuffer,a};var M=/[^+\/0-9A-z]/g},{"base64-js":74,ieee754:75,"is-array":76}],74:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g?62:b===h?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],75:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],76:[function(a,b,c){var d=Array.isArray,e=Object.prototype.toString;b.exports=d||function(a){return!!a&&"[object Array]"==e.call(a)}},{}],77:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],78:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}]},{},[28]);
//# sourceMappingURL=engine.min.js.map